<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è½ã¨ã—ç‰©ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆä»®ï¼‰ãƒ¢ãƒƒã‚¯</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Sans+JP:wght@400;500;600;700&display=swap');

    :root {
      --primary: #1C335C;
      --primary-hover: #132544;
      --primary-light: #E6EAF3;
      --secondary: #0E7490;
      --bg: #F9FAFB;
      --card: #FFFFFF;
      --muted: #6B7280;
      --muted-strong: #4B5563;
      --heading: #111827;
      --border: #E5E7EB;
      --hover: #F3F4F6;
      --warning: #F59E0B;
      --danger: #DC2626;
      --neutral: #6B7280;
      --shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', 'Noto Sans JP', system-ui, -apple-system, sans-serif;
      background: linear-gradient(180deg, #F9FAFB 0%, #F3F4F6 100%);
      color: var(--muted-strong);
      line-height: 1.5;
      min-height: 100vh;
      position: relative;
      overflow-x: hidden;
    }
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160'%3E%3Cg fill='%23E5E7EB' fill-opacity='0.25'%3E%3Ccircle cx='10' cy='10' r='1'/%3E%3Ccircle cx='80' cy='40' r='1'/%3E%3Ccircle cx='140' cy='90' r='1'/%3E%3Ccircle cx='30' cy='120' r='1'/%3E%3C/g%3E%3C/svg%3E");
      opacity: 0.4;
    }

    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 22px;
      background: rgba(255, 255, 255, 0.92);
      backdrop-filter: blur(14px);
      border-bottom: 1px solid var(--border);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      color: var(--heading);
      letter-spacing: 0.01em;
    }
    .brand-mark {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      display: grid;
      place-items: center;
      color: #fff;
      font-weight: 800;
      font-size: 14px;
      box-shadow: 0 6px 20px rgba(37, 99, 235, 0.22);
    }

    .facility {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 10px;
      background: #EEF2FF;
      color: #4338CA;
      font-weight: 600;
      font-size: 13px;
    }

    .user-meta {
      display: flex;
      align-items: center;
      gap: 14px;
      font-size: 14px;
      color: var(--muted);
    }
    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, #DBEAFE, #BFDBFE);
      border: 1px solid #D1D5DB;
      display: grid;
      place-items: center;
      color: var(--heading);
      font-weight: 700;
    }

    main {
      width: min(1320px, 94vw);
      margin: 24px auto 80px;
      display: grid;
      gap: 22px;
    }

    .section {
      background: linear-gradient(180deg, #FFFFFF 0%, #F9FAFB 100%);
      border: 1px solid var(--border);
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(15, 23, 42, 0.06);
      padding: 18px 20px;
      animation: fadeUp 0.4s ease;
    }

    .section-heading {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    h1, h2, h3, h4 {
      margin: 0;
      color: var(--heading);
      font-weight: 700;
      letter-spacing: 0.01em;
    }
    h1 { font-size: 18px; font-weight: 600; }
    h2 { font-size: 16px; font-weight: 600; }
    h3 { font-size: 14px; font-weight: 600; }

    p { margin: 0; color: var(--muted); }

    .actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    button {
      font-family: inherit;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.2s ease;
      font-weight: 600;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
      padding: 12px 16px;
      box-shadow: 0 4px 16px rgba(28, 51, 93, 0.28);
    }
    .btn-primary:hover { background: var(--primary-hover); transform: translateY(-1px); }
    .btn-outline {
      background: white;
      color: #344054;
      border: 1px solid #CBD5E1;
      padding: 11px 15px;
    }
    .btn-ghost {
      background: transparent;
      color: var(--muted-strong);
      padding: 10px 12px;
    }

    .grid {
      display: grid;
      gap: 14px;
    }
    .summary {
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 10px;
      position: relative;
      overflow: hidden;
      transition: box-shadow 0.2s ease, transform 0.15s ease, border-color 0.2s ease;
      box-shadow: var(--shadow);
    }
    .card:hover { box-shadow: 0 6px 16px rgba(15,23,42,0.08); transform: translateY(-1px); border-color: #D7E3FF; }
    .card small { color: var(--muted); font-size: 12px; font-weight: 600; letter-spacing: 0.02em; }
    .card .value { font-size: 28px; font-weight: 800; color: var(--heading); }
    .card .chip {
      position: absolute;
      right: 12px;
      top: 12px;
      background: #F1F5F9;
      color: #334155;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 700;
    }
    .card .hint {
      font-size: 12px;
      color: var(--muted);
    }

    .search-area {
      display: grid;
      gap: 12px;
      background: #FFFFFF;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      position: relative;
      overflow: hidden;
    }
    .search-area::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(600px at 20% 20%, rgba(37,99,235,0.06), transparent 60%),
                  radial-gradient(500px at 80% 10%, rgba(14,165,233,0.05), transparent 55%);
      pointer-events: none;
    }
    .search-row {
      display: grid;
      grid-template-columns: 2fr 1.2fr 1.2fr 1fr 1fr auto;
      gap: 10px;
      align-items: start;
    }
    .input {
      position: relative;
    }
    .input input, .input select, .input textarea {
      width: 100%;
      padding: 12px 12px 12px 38px;
      border: 1px solid #D1D5DB;
      border-radius: 12px;
      background: white;
      color: var(--muted-strong);
      font-size: 14px;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, transform 0.15s ease;
    }
    .input select { appearance: none; background-image: url("data:image/svg+xml,%3Csvg width='14' height='14' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%236B7280' d='M2 4l5 6 5-6'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 12px center; padding-right: 32px; }
    .input input:focus, .input select:focus, .input textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
      transform: translateY(-1px);
    }
    .input .icon {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-size: 15px;
    }
    .label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
      font-weight: 600;
    }
    .field {
      display: grid;
      gap: 6px;
    }

    .pills {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .pill {
      border: 1px solid #D5D7DD;
      background: #F6F7FA;
      color: #374151;
      padding: 7px 10px;
      border-radius: 12px;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.15s ease;
    }
    .pill.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
      box-shadow: 0 4px 12px rgba(28, 51, 93, 0.2);
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .filter-chip {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: #EEF2FF;
      color: #4338CA;
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 600;
      font-size: 13px;
    }
    .filter-chip button {
      background: transparent;
      border: none;
      color: #4338CA;
      font-size: 14px;
      padding: 0;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      overflow: hidden;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: white;
    }
    thead {
      background: #F3F4F6;
      color: var(--muted-strong);
      font-weight: 600;
      font-size: 12px;
    }
    th, td {
      padding: 10px 12px;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }
    tbody tr {
      cursor: pointer;
      transition: background 0.12s ease;
      opacity: 0;
      animation: fadeRow 0.35s ease forwards;
    }
    tbody tr:hover { background: #F5F7FA; }
    tbody tr.selected-row { background: #F3F6FF; box-shadow: inset 2px 0 0 var(--primary); }
    tbody tr:last-child td { border-bottom: none; }

    .thumb {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      object-fit: cover;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, #E0EAFF, #F9FAFB);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 6px 10px;
      font-weight: 700;
      font-size: 12px;
    }
    .status-stock { background: rgba(37, 99, 235, 0.1); color: var(--primary); }
    .status-warning { background: rgba(245, 158, 11, 0.12); color: var(--warning); }
    .status-danger { background: rgba(220, 38, 38, 0.12); color: var(--danger); }
    .status-complete { background: rgba(107, 114, 128, 0.16); color: var(--neutral); }

    .table-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 6px 0 10px;
      color: var(--muted);
      font-size: 13px;
    }

    body.modal-open { overflow: hidden; }

    .detail-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      backdrop-filter: blur(3px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 30;
    }
    .detail-overlay.show { opacity: 1; pointer-events: auto; }

    .detail-panel {
      position: fixed;
      inset: 0;
      margin: auto;
      width: min(640px, 92vw);
      max-height: 86vh;
      height: auto;
      background: white;
      border: 1px solid var(--border);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.28);
      border-radius: 18px;
      padding: 18px 20px;
      display: grid;
      gap: 14px;
      opacity: 0;
      transform: translateY(14px) scale(0.98);
      pointer-events: none;
      overflow-y: auto;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 40;
    }
    .detail-panel.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .detail-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .detail-id { font-weight: 800; font-size: 20px; color: var(--heading); }
    .detail-photo {
      width: 100%;
      border-radius: 12px;
      height: 200px;
      object-fit: cover;
      background: linear-gradient(135deg, #E0EAFF, #F9FAFB);
      border: 1px solid var(--border);
    }
    .detail-photo-wrap {
      position: relative;
      display: grid;
    }
    .detail-photo-badge {
      position: absolute;
      right: 10px;
      top: 10px;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      font-weight: 700;
      border: 1px solid transparent;
      background: rgba(15, 23, 42, 0.12);
      color: #1F2937;
    }
    .detail-photo-badge.missing {
      background: rgba(245, 158, 11, 0.14);
      color: #92400E;
      border-color: rgba(245, 158, 11, 0.3);
    }
    .detail-photo-badge.ready {
      background: rgba(16, 185, 129, 0.14);
      color: #047857;
      border-color: rgba(16, 185, 129, 0.3);
    }
    .detail-photo-note {
      font-size: 12px;
      color: var(--muted);
      margin-top: -6px;
    }
    .detail-tabs {
      display: flex;
      gap: 8px;
      padding: 4px;
      border-radius: 12px;
      background: #F3F4F6;
    }
    .detail-tab {
      flex: 1;
      background: transparent;
      border: none;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 13px;
      font-weight: 700;
      color: var(--muted-strong);
      box-shadow: none;
    }
    .detail-tab:hover { transform: none; }
    .detail-tab.active {
      background: white;
      color: var(--heading);
      box-shadow: var(--shadow);
    }
    .detail-tab-content { display: none; gap: 12px; }
    .detail-tab-content.active { display: grid; }
    .detail-grid { display: grid; gap: 10px; font-size: 14px; }
    .detail-section { border-bottom: 1px solid var(--border); padding-bottom: 8px; margin-bottom: 8px; }
    .detail-section:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
    .detail-section h4 { margin: 0 0 6px; font-size: 13px; color: var(--muted); letter-spacing: 0.01em; }
    .detail-row { display: grid; grid-template-columns: 1fr 1.2fr; gap: 8px; padding: 4px 0; }
    .detail-label { color: #374151; font-weight: 700; font-size: 12.5px; }
    .detail-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .detail-input,
    .detail-select,
    .detail-textarea {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #D1D5DB;
      border-radius: 8px;
      font-size: 13px;
      color: var(--muted-strong);
      background: #fff;
    }
    .detail-input[readonly] {
      background: #F8FAFC;
      color: var(--muted);
    }
    .detail-textarea { min-height: 72px; resize: vertical; }
    .detail-duo { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
    .detail-help { font-size: 12px; color: var(--muted); margin-top: 4px; }
    .detail-edit-actions { display: flex; gap: 8px; flex-wrap: wrap; }
    .detail-meta-text { font-size: 12.5px; color: var(--muted-strong); font-weight: 600; }

    .progress-track {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      margin-bottom: 4px;
    }
    .progress-step {
      text-align: center;
      font-size: 12px;
      font-weight: 700;
      padding: 8px 6px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #F3F4F6;
      color: var(--muted-strong);
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
    }
    .progress-step:hover { transform: translateY(-1px); }
    .progress-step.done {
      background: rgba(37, 99, 235, 0.12);
      color: var(--primary);
      border-color: rgba(37, 99, 235, 0.4);
    }
    .progress-step.active {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      box-shadow: 0 8px 16px rgba(28,51,93,0.2);
    }

    .history-list { display: grid; gap: 8px; margin: 4px 0 8px; }
    .history-item {
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 8px 10px;
      background: #F8FAFC;
      display: grid;
      gap: 4px;
    }
    .history-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .history-type { font-weight: 700; color: var(--heading); font-size: 12.5px; }
    .history-time { font-size: 11.5px; color: var(--muted); }
    .history-badge { font-size: 11px; padding: 4px 8px; }
    .history-note { font-size: 13px; color: var(--muted-strong); white-space: pre-wrap; }
    .history-empty {
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 10px;
      font-size: 12px;
      color: var(--muted);
      background: #FBFCFE;
    }
    .history-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    .match-layout {
      display: grid;
      grid-template-columns: 0.9fr 2.1fr 1.1fr;
      gap: 16px;
    }
    .match-left, .match-center, .match-right {
      background: white;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px;
      box-shadow: 0 6px 14px rgba(15,23,42,0.05);
    }
    .match-left textarea, .match-left input, .match-left select {
      width: 100%;
      padding: 10px;
      border: 1px solid #D1D5DB;
      border-radius: 8px;
      font-size: 14px;
      color: var(--muted-strong);
    }
    .match-left textarea { min-height: 74px; resize: vertical; }
    .match-center { display: grid; gap: 12px; position: relative; }
    .match-center::before, .match-center::after {
      content: '';
      position: sticky;
      left: 0; right: 0;
      height: 18px;
      pointer-events: none;
      z-index: 1;
    }
    .match-center::before {
      top: 0;
      background: linear-gradient(180deg, rgba(255,255,255,0.85), transparent);
    }
    .match-center::after {
      bottom: -1px;
      background: linear-gradient(0deg, rgba(255,255,255,0.85), transparent);
    }
    .match-meta { color: var(--muted-strong); font-size: 13px; font-weight: 700; display:flex; justify-content:space-between; align-items:center; }
    .match-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 14px;
      max-height: 640px;
      overflow-y: auto;
      padding: 4px 2px 12px;
    }
    .match-card {
      background: #F8FAFC;
      border: 1px solid var(--border);
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.15s ease, border-color 0.15s ease, box-shadow 0.15s ease;
      display: grid;
      gap: 8px;
    }
    .match-card:hover { transform: translateY(-2px); border-color: #CBD5E1; box-shadow: 0 8px 16px rgba(15,23,42,0.07); }
    .match-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      background: #E5E7EB;
    }
    .match-card .body { padding: 8px 10px 10px; display: grid; gap: 6px; }
    .match-card .title { font-weight: 800; color: var(--heading); }
    .match-card .sub { color: var(--muted); font-size: 12px; }
    .match-card .tags { display: flex; gap: 6px; flex-wrap: wrap; }
    .match-card .tag { background: #E5E7EB; color: #374151; padding: 4px 8px; border-radius: 999px; font-size: 11px; font-weight: 700; }
    .match-card.selected { border-color: var(--primary); box-shadow: 0 10px 20px rgba(28,51,93,0.18); transform: translateY(-2px); }
    .match-card.selected .tag.selected-badge { background: rgba(28,51,93,0.1); color: var(--primary); border: 1px solid #C8D1E2; }
    .match-detail {
      display: grid;
      gap: 10px;
    }
    .match-photo-wrap { background: #F5F7FA; border: 1px solid var(--border); border-radius: 10px; padding: 8px; }
    .match-photo { width: 100%; border-radius: 8px; object-fit: cover; height: 260px; }
    .match-detail-body { display: grid; gap: 6px; }

    .toast {
      position: fixed;
      top: 18px;
      right: 18px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 12px 14px;
      box-shadow: var(--shadow);
      color: var(--heading);
      font-weight: 700;
      opacity: 0;
      transform: translateY(-10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 50;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    .fade-in {
      animation: fadeUp 0.35s ease;
    }
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes fadeRow {
      from { opacity: 0; transform: translateY(6px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .mood {
      position: relative;
      overflow: hidden;
      border-radius: 12px;
      padding: 12px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, #FFFFFF, #F5F6FA);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.08);
      display: grid;
      gap: 8px;
      max-height: 180px;
    }
    .mood h2 { color: #0F172A; }
    .mood p { color: #0F172A; }
    .rail {
      display: grid;
      grid-auto-flow: column;
      grid-auto-columns: 160px;
      gap: 12px;
      overflow-x: auto;
      padding: 4px;
      scrollbar-width: none;
    }
    .rail::-webkit-scrollbar { display: none; }
    .tile {
      position: relative;
      border-radius: 12px;
      overflow: hidden;
      height: 120px;
      border: 1px solid rgba(255,255,255,0.6);
      box-shadow: 0 16px 32px rgba(15, 23, 42, 0.2);
      transform: translateY(0);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .tile img { width: 100%; height: 100%; object-fit: cover; }
    .tile:hover { transform: translateY(-4px) scale(1.02); box-shadow: 0 24px 44px rgba(15, 23, 42, 0.28); }
    .tile .tag {
      position: absolute;
      left: 10px;
      bottom: 10px;
      padding: 8px 10px;
      background: rgba(0, 0, 0, 0.55);
      color: #fff;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 700;
      backdrop-filter: blur(4px);
    }

    .tabs {
      display: inline-flex;
      border-bottom: 1px solid var(--border);
      gap: 4px;
      padding-bottom: 4px;
    }
    .tab {
      padding: 11px 16px 9px;
      font-weight: 700;
      font-size: 14px;
      color: #6B7280;
      cursor: pointer;
      transition: color 0.15s ease;
      border-bottom: 2px solid transparent;
    }
    .tab.active {
      color: var(--primary);
      border-color: var(--primary);
    }

    .two-col {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
    }

    .login-preview {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
      align-items: center;
    }

    .login-card {
      width: min(380px, 90%);
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 12px;
    }
    .login-card h3 { text-align: center; }
    .login-card .input input { padding-left: 12px; }
    .subtle-link { color: var(--muted); font-size: 13px; text-align: center; }

    .phone {
      width: 360px;
      max-width: 100%;
      margin: 0 auto;
      border-radius: 24px;
      border: 1px solid var(--border);
      background: #0B1B2E;
      padding: 12px;
      box-shadow: 0 24px 80px rgba(15, 23, 42, 0.35);
    }
    .phone .screen {
      background: #F9FAFB;
      border-radius: 16px;
      padding: 16px;
      min-height: 520px;
      display: grid;
      gap: 14px;
      position: relative;
      overflow: hidden;
    }
    .mobile-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-weight: 700;
      color: var(--heading);
      font-size: 14px;
    }
    .stepper {
      display: flex;
      gap: 6px;
      align-items: center;
      font-weight: 700;
      color: var(--muted);
    }
    .dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--border);
    }
    .dot.active { background: var(--primary); box-shadow: 0 0 0 6px rgba(37, 99, 235, 0.14); }
    .mobile-card {
      background: white;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      display: grid;
      gap: 10px;
    }
    .mobile-primary {
      background: var(--primary);
      color: white;
      border-radius: 12px;
      padding: 14px;
      text-align: center;
      font-weight: 700;
      box-shadow: 0 12px 32px rgba(37, 99, 235, 0.3);
    }
    .mobile-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      padding: 12px;
      border-radius: 12px;
      text-align: center;
      font-weight: 700;
    }
    .mobile-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    .mobile-option {
      background: #F8FAFC;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      font-weight: 700;
      font-size: 13px;
      color: var(--muted-strong);
      transition: all 0.15s ease;
    }
    .mobile-option.active {
      border-color: var(--primary);
      background: var(--primary-light);
      color: var(--primary);
      box-shadow: 0 8px 20px rgba(37, 99, 235, 0.18);
    }
    .mobile-bottom {
      position: sticky;
      bottom: 0;
      padding: 10px;
      background: linear-gradient(180deg, rgba(249, 250, 251, 0.6), #F9FAFB);
      border-radius: 12px;
    }

    .pill-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 10px 12px;
      border-radius: 12px;
      background: #0F172A;
      color: white;
      font-weight: 700;
      font-size: 12px;
    }

    .highlight {
      background: linear-gradient(120deg, rgba(37, 99, 235, 0.12), rgba(14, 165, 233, 0.12));
      border: 1px dashed rgba(37, 99, 235, 0.4);
      padding: 12px;
      border-radius: 10px;
    }

    .settings-shell {
      display: grid;
      gap: 16px;
    }
    .settings-hero {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding: 16px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(28, 51, 92, 0.08), rgba(14, 116, 144, 0.08));
    }
    .settings-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--heading);
      margin-bottom: 4px;
    }
    .settings-tabs {
      display: flex;
      flex-wrap: wrap;
      width: 100%;
      gap: 4px;
    }
    .settings-panel {
      display: none;
      background: white;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      gap: 12px;
      box-shadow: var(--shadow);
    }
    .settings-panel.active {
      display: grid;
    }
    .settings-panel-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .settings-panel-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 700;
      color: var(--heading);
    }
    .settings-tag {
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 700;
      background: #EEF2FF;
      color: #3730A3;
    }
    .settings-tag.priority {
      background: rgba(245, 158, 11, 0.14);
      color: #92400E;
    }
    .settings-panel-sub {
      font-size: 13px;
      color: var(--muted);
    }
    .settings-example {
      font-size: 13px;
      color: var(--muted-strong);
      background: #F1F5F9;
      border-radius: 10px;
      padding: 8px 10px;
    }
    .settings-content {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 280px;
      gap: 14px;
    }
    .settings-table {
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background: white;
    }
    .settings-table table {
      border: none;
    }
    .settings-table tbody tr {
      cursor: pointer;
      opacity: 1;
      animation: none;
    }
    .settings-table tbody tr:hover { background: #F8FAFC; }
    .settings-side {
      display: grid;
      gap: 12px;
    }
    .settings-box {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px;
      background: #F9FAFB;
      display: grid;
      gap: 8px;
    }
    .settings-box p { font-size: 13px; }
    .field-list {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .field-chip {
      border-radius: 999px;
      padding: 6px 10px;
      border: 1px solid #E2E8F0;
      background: white;
      font-size: 12px;
      font-weight: 700;
      color: #334155;
    }
    .field-chip.required {
      border-color: #C7D2FE;
      background: #EEF2FF;
      color: #3730A3;
    }
    .status-pill {
      display: inline-flex;
      align-items: center;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 11px;
      font-weight: 700;
      background: rgba(16, 185, 129, 0.12);
      color: #047857;
    }
    .status-pill.inactive {
      background: rgba(148, 163, 184, 0.25);
      color: #475569;
    }
    .settings-later {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 12px;
    }
    .settings-later-card {
      border: 1px dashed #CBD5E1;
      border-radius: 12px;
      padding: 12px;
      background: #F8FAFC;
      display: grid;
      gap: 6px;
    }
    .settings-later-tag {
      width: fit-content;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 700;
      color: #64748B;
      background: #E2E8F0;
    }
    .settings-later-title {
      font-weight: 700;
      color: var(--heading);
    }
    .settings-later-note {
      font-size: 12px;
      color: var(--muted);
    }
    .contact-shell {
      display: grid;
      grid-template-columns: minmax(280px, 0.85fr) minmax(320px, 1.15fr);
      gap: 16px;
      align-items: start;
    }
    .contact-panel {
      background: white;
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 14px;
      display: grid;
      gap: 12px;
      box-shadow: var(--shadow);
    }
    .contact-list-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .contact-list-title {
      font-size: 15px;
      font-weight: 700;
      color: var(--heading);
    }
    .contact-list-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }
    .contact-filter {
      display: grid;
      gap: 10px;
    }
    .contact-meta {
      font-size: 12px;
      color: var(--muted);
    }
    .contact-list {
      display: grid;
      gap: 10px;
    }
    .contact-card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px;
      display: grid;
      gap: 8px;
      background: #fff;
      cursor: pointer;
      transition: box-shadow 0.2s ease, border-color 0.2s ease, transform 0.15s ease;
    }
    .contact-card:hover { border-color: #D7E3FF; box-shadow: 0 8px 18px rgba(15,23,42,0.08); transform: translateY(-1px); }
    .contact-card.active { border-color: var(--primary); box-shadow: 0 10px 22px rgba(28, 51, 93, 0.18); }
    .contact-card-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .contact-card-title {
      font-weight: 700;
      color: var(--heading);
      font-size: 13px;
    }
    .case-status {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: 999px;
      padding: 4px 8px;
      font-weight: 700;
      font-size: 11px;
      border: 1px solid transparent;
    }
    .case-status.in-progress {
      background: rgba(59, 130, 246, 0.12);
      color: #1D4ED8;
      border-color: rgba(59, 130, 246, 0.25);
    }
    .case-status.match {
      background: rgba(16, 185, 129, 0.12);
      color: #047857;
      border-color: rgba(16, 185, 129, 0.28);
    }
    .case-status.miss {
      background: rgba(245, 158, 11, 0.15);
      color: #92400E;
      border-color: rgba(245, 158, 11, 0.28);
    }
    .case-status.close {
      background: rgba(148, 163, 184, 0.22);
      color: #475569;
      border-color: rgba(148, 163, 184, 0.35);
    }
    .contact-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 11px;
      color: var(--muted);
    }
    .contact-chip {
      background: #F1F5F9;
      color: #334155;
      border-radius: 999px;
      padding: 4px 8px;
      font-weight: 700;
      font-size: 11px;
    }
    .contact-snippet {
      font-size: 12px;
      color: var(--muted-strong);
    }
    .contact-empty {
      padding: 14px;
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      border: 1px dashed var(--border);
      border-radius: 12px;
      background: #F8FAFC;
    }
    .contact-detail-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .contact-detail-id {
      font-size: 16px;
      font-weight: 800;
      color: var(--heading);
    }
    .contact-detail-sub {
      font-size: 12px;
      color: var(--muted);
    }
    .contact-section {
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      background: #F9FAFB;
      display: grid;
      gap: 10px;
    }
    .contact-section-title {
      font-weight: 700;
      color: var(--heading);
      font-size: 13px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .contact-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }
    .contact-textarea {
      min-height: 96px;
    }
    .contact-match-card {
      border: 1px solid #C7D2FE;
      border-radius: 12px;
      padding: 10px;
      background: #EEF2FF;
      display: grid;
      gap: 8px;
    }
    .contact-match-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .contact-match-title {
      font-weight: 700;
      color: var(--heading);
      font-size: 13px;
    }
    .contact-match-meta {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .contact-match-body {
      display: grid;
      grid-template-columns: 60px 1fr;
      gap: 10px;
      align-items: center;
    }
    .contact-match-body img {
      width: 60px;
      height: 60px;
      border-radius: 10px;
      border: 1px solid var(--border);
      object-fit: cover;
      background: #F1F5F9;
    }
    .contact-candidate-list {
      display: grid;
      gap: 8px;
    }
    .contact-candidate {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px;
      display: grid;
      grid-template-columns: 56px 1fr auto;
      gap: 10px;
      align-items: center;
      background: #fff;
    }
    .contact-candidate img {
      width: 56px;
      height: 56px;
      border-radius: 10px;
      border: 1px solid var(--border);
      object-fit: cover;
      background: #F1F5F9;
    }
    .contact-candidate .title {
      font-weight: 700;
      color: var(--heading);
      font-size: 13px;
    }
    .contact-candidate .sub {
      font-size: 12px;
      color: var(--muted);
    }
    .settings-actions {
      display: inline-flex;
      gap: 6px;
      flex-wrap: wrap;
    }
    .settings-actions button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    .btn-compact {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: 10px;
    }
    .btn-neutral {
      background: #F1F5F9;
      color: #334155;
      border: 1px solid #E2E8F0;
    }
    .btn-danger {
      background: rgba(220, 38, 38, 0.12);
      color: #B91C1C;
      border: 1px solid rgba(220, 38, 38, 0.25);
    }
    .btn-success {
      background: rgba(16, 185, 129, 0.14);
      color: #047857;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    .settings-empty {
      text-align: center;
      color: var(--muted);
      padding: 14px;
      font-size: 13px;
    }
    .settings-modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(15, 23, 42, 0.35);
      backdrop-filter: blur(3px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
      z-index: 45;
    }
    .settings-modal-overlay.show { opacity: 1; pointer-events: auto; }
    .settings-modal {
      position: fixed;
      inset: 0;
      margin: auto;
      width: min(640px, 92vw);
      max-height: 90vh;
      background: linear-gradient(180deg, #FFFFFF 0%, #F8FAFC 100%);
      border: 1px solid var(--border);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.28);
      border-radius: 18px;
      padding: 18px 20px 16px;
      display: grid;
      gap: 16px;
      opacity: 0;
      transform: translateY(14px) scale(0.98);
      pointer-events: none;
      overflow-y: auto;
      transition: opacity 0.2s ease, transform 0.2s ease;
      z-index: 55;
    }
    .settings-modal.open { opacity: 1; transform: translateY(0) scale(1); pointer-events: auto; }
    .settings-modal-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }
    .settings-modal-title-group {
      display: grid;
      gap: 4px;
    }
    .settings-modal-eyebrow {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
    }
    .settings-modal-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--heading);
    }
    .settings-modal-sub {
      font-size: 13px;
      color: var(--muted);
    }
    .settings-modal-body {
      display: grid;
      gap: 14px;
    }
    .settings-section {
      display: grid;
      gap: 10px;
      padding: 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: white;
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.06);
    }
    .settings-section-title {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 13px;
      font-weight: 700;
      color: var(--heading);
    }
    .settings-section-sub {
      font-size: 12px;
      color: var(--muted);
      margin-top: -6px;
    }
    .settings-form-grid {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }
    .settings-field {
      display: grid;
      gap: 6px;
    }
    .settings-label-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .settings-label-row .label { margin: 0; }
    .settings-required {
      padding: 3px 6px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      border: 1px solid #C7D2FE;
      background: #EEF2FF;
      color: #3730A3;
    }
    .settings-helper {
      font-size: 11px;
      color: var(--muted);
    }
    .settings-modal input,
    .settings-modal select,
    .settings-modal textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #D1D5DB;
      border-radius: 10px;
      background: white;
      color: var(--muted-strong);
      font-size: 14px;
    }
    .settings-modal input:focus,
    .settings-modal select:focus,
    .settings-modal textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
    }
    .settings-toggle {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--muted-strong);
    }
    .settings-toggle input { width: 16px; height: 16px; }
    .settings-modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      padding-top: 8px;
      border-top: 1px solid var(--border);
    }

    footer {
      margin: 16px auto 40px;
      color: var(--muted);
      text-align: center;
      font-size: 13px;
    }

    @media (max-width: 1100px) {
      .search-row { grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); }
      .two-col { grid-template-columns: 1fr; }
      .login-preview { grid-template-columns: 1fr; }
      .settings-hero { flex-direction: column; align-items: flex-start; }
      .settings-content { grid-template-columns: 1fr; }
      .contact-shell { grid-template-columns: 1fr; }
    }
    @media (max-width: 720px) {
      .topbar { flex-wrap: wrap; gap: 10px; }
      main { width: 94vw; margin-top: 12px; }
      h1 { font-size: 18px; }
      .detail-panel { width: 94vw; max-height: 90vh; }
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand-mark">LC</div>
      <div>
        <div>è½ã¨ã—ç‰©ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆä»®ï¼‰</div>
        <small style="color: var(--muted); font-weight:600;">æ—…é¤¨ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰ã®ç›¸æ£’</small>
      </div>
    </div>
    <div class="facility">èŠ±æœˆæ—…é¤¨ãƒ»æœ¬é¤¨ â–¼</div>
    <div class="user-meta">
      <span>é’æœ¨ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆï¼‰</span>
      <div class="avatar">A</div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="section-heading">
        <div>
          <h1>è½ã¨ã—ç‰©ç®¡ç†</h1>
          <p>ç™»éŒ²ãƒ»æ¤œç´¢ãƒ»ä¿ç®¡çŠ¶æ³ã®ç¢ºèªãŒã§ãã¾ã™ã€‚</p>
        </div>
        <div class="actions">
          <button class="btn-outline" id="exportBtn">CSVå‡ºåŠ›</button>
          <button class="btn-primary" id="addBtn">ï¼‹ è½ã¨ã—ç‰©ã‚’ç™»éŒ²</button>
        </div>
      </div>

      <div class="tabs" id="mainTabSwitch">
        <div class="tab active" data-tab="list">ä¸€è¦§</div>
        <div class="tab" data-tab="deadline">æœŸé™ç®¡ç†</div>
        <div class="tab" data-tab="settings">è¨­å®šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
        <div class="tab" data-tab="match">ç…§åˆãƒ“ãƒ¥ãƒ¼ï¼ˆå†™çœŸã§æ¢ã™ï¼‰</div>
        <div class="tab" data-tab="contact">å•ã„åˆã‚ã›å¯¾å¿œ</div>
      </div>

      <div class="grid summary">
        <div class="card clickable" data-filter="today">
          <small>ä»Šæ—¥ç™»éŒ²</small>
          <div class="value" id="todayCount">8ä»¶</div>
          <span class="chip">ï¼‹12%</span>
          <div class="hint">08:30ã«æ¸…æƒæ‹…å½“ãŒ4ä»¶è¿½åŠ </div>
        </div>
        <div class="card clickable" data-filter="stock">
          <small>ä¿ç®¡ä¸­</small>
          <div class="value" id="stockCount">34ä»¶</div>
          <span class="chip">å€‰åº«A/B</span>
          <div class="hint">ãƒ•ãƒ­ãƒ³ãƒˆæ£šã¨å€‰åº«ã«æŒ¯ã‚Šåˆ†ã‘æ¸ˆã¿</div>
        </div>
        <div class="card clickable" data-filter="warning">
          <small>æœŸé™é–“è¿‘ï¼ˆ7æ—¥ä»¥å†…ï¼‰</small>
          <div class="value" id="warningCount">4ä»¶</div>
          <span class="chip">å„ªå…ˆå‡¦ç†</span>
          <div class="hint">å»ƒæ£„å€™è£œã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†</div>
        </div>
        <div class="card clickable" data-filter="expired">
          <small>æœŸé™åˆ‡ã‚Œ</small>
          <div class="value" id="expiredCount">2ä»¶</div>
          <span class="chip" style="background: rgba(220, 38, 38, 0.12); color: var(--danger);">å‡¦ç†å¾…ã¡</span>
          <div class="hint">è­¦å¯Ÿ or å»ƒæ£„æ‰‹é…ãŒå¿…è¦ã§ã™</div>
        </div>
      </div>

      <div class="search-area">
        <div class="search-row">
          <div class="field">
            <div class="label">ãƒ•ãƒªãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>
            <div class="input">
              <span class="icon">ğŸ”</span>
              <input id="keyword" type="text" placeholder="è‰²ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»ç‰¹å¾´ãƒ»éƒ¨å±‹ç•ªå·ãªã©">
            </div>
          </div>
          <div class="field">
            <div class="label">æ—¥ä»˜ãƒ¢ãƒ¼ãƒ‰</div>
            <div class="pills" id="dateMode">
              <div class="pill active" data-mode="found">ç™ºè¦‹æ—¥</div>
              <div class="pill" data-mode="stay">å®¿æ³Šæ—¥</div>
            </div>
          </div>
          <div class="field">
            <div class="label">æ—¥ä»˜</div>
            <div class="pills" id="dateQuick">
              <div class="pill active" data-range="today">ä»Šæ—¥</div>
              <div class="pill" data-range="yesterday">æ˜¨æ—¥</div>
              <div class="pill" data-range="3days">3æ—¥é–“</div>
              <div class="pill" data-range="week">1é€±é–“</div>
              <div class="pill" data-range="custom">ã‚«ã‚¹ã‚¿ãƒ </div>
            </div>
          </div>
          <div class="field">
            <div class="label">ã‚«ãƒ†ã‚´ãƒª</div>
            <div class="input">
              <span class="icon">ğŸ—‚</span>
              <select id="categorySelect">
                <option value="all">ã™ã¹ã¦</option>
                <option>è²¡å¸ƒ</option>
                <option>ã‚«ãƒãƒ³</option>
                <option>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</option>
                <option>å……é›»å™¨</option>
                <option>éµ</option>
                <option>è¡£é¡</option>
                <option>ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³å°ç‰©</option>
                <option>ãƒ¡ã‚¬ãƒ</option>
                <option>åŒ–ç²§å“</option>
                <option>é´</option>
                <option>å‚˜</option>
                <option>ãã®ä»–</option>
              </select>
            </div>
          </div>
          <div class="field">
            <div class="label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
            <div class="pills" id="statusSelect">
              <div class="pill active" data-status="ä¿ç®¡ä¸­">ä¿ç®¡ä¸­</div>
              <div class="pill" data-status="æœŸé™é–“è¿‘">æœŸé™é–“è¿‘</div>
              <div class="pill" data-status="æœŸé™åˆ‡ã‚Œ">æœŸé™åˆ‡ã‚Œ</div>
              <div class="pill" data-status="è¿”å´æ¸ˆ">è¿”å´æ¸ˆ</div>
              <div class="pill" data-status="è­¦å¯Ÿå¼•æ¸¡ã—">è­¦å¯Ÿå¼•æ¸¡ã—</div>
              <div class="pill" data-status="å»ƒæ£„æ¸ˆ">å»ƒæ£„æ¸ˆ</div>
            </div>
          </div>
          <div class="field" style="align-self:flex-end;">
            <button class="btn-ghost" id="clearFilters">æ¡ä»¶ã‚’ã‚¯ãƒªã‚¢</button>
          </div>
        </div>
        <div class="label" style="font-weight:700; color: var(--muted-strong);">ç¾åœ¨ã®æ¡ä»¶</div>
        <div class="filters" id="filterChips"></div>
        <div style="height:1px; background: var(--border);"></div>
      </div>

      <div class="table-meta">
        <div id="tableMetaText">å…¨ 42ä»¶ / è¡¨ç¤º 10ä»¶</div>
      </div>

      <div id="viewList">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>å†™çœŸ</th>
                <th>ç®¡ç†ç•ªå·</th>
                <th>ã‚«ãƒ†ã‚´ãƒª</th>
                <th>ç™ºè¦‹æ—¥</th>
                <th>å®¿æ³Šæ—¥</th>
                <th>æ‹¾å¾—å ´æ‰€</th>
                <th>éƒ¨å±‹</th>
                <th>ä¿ç®¡å ´æ‰€</th>
                <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                <th>ä¿ç®¡æœŸé™</th>
              </tr>
            </thead>
            <tbody id="tableBody"></tbody>
          </table>
        </div>
      </div>

      <div id="viewDeadline" style="display:none;">
        <div id="deadlineList" class="grid" style="margin-top:12px;"></div>
      </div>

      <div id="viewSettings" style="display:none;">
        <div class="settings-shell">
          <div class="settings-hero">
            <div>
              <div class="settings-title">è¨­å®šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
              <p>æ‹¾å¾—å ´æ‰€ â†’ ä¿ç®¡å ´æ‰€ â†’ ã‚«ãƒ†ã‚´ãƒªã®é †ã§æ•´å‚™ã™ã‚‹ã¨é‹ç”¨ãŒå®‰å®šã—ã¾ã™ã€‚</p>
            </div>
            <div class="actions">
              <button class="btn-primary" id="settingsAddBtn">ï¼‹ æ–°è¦è¿½åŠ </button>
            </div>
          </div>

          <div class="tabs settings-tabs" id="settingsTabSwitch">
            <div class="tab active" data-settings-tab="pickup">æ‹¾å¾—å ´æ‰€</div>
            <div class="tab" data-settings-tab="storage">ä¿ç®¡å ´æ‰€</div>
            <div class="tab" data-settings-tab="category">ã‚«ãƒ†ã‚´ãƒª</div>
          </div>

          <div class="settings-panel active" data-settings-panel="pickup">
            <div class="settings-panel-head">
              <div>
                <div class="settings-panel-title">æ‹¾å¾—å ´æ‰€ãƒã‚¹ã‚¿ï¼ˆPickupLocationMasterï¼‰<span class="settings-tag priority">æœ€å„ªå…ˆ</span></div>
                <div class="settings-panel-sub">æ¸©æµ´ä»¥å¤–ï¼ˆãƒ›ãƒ†ãƒ«/é£²é£Ÿ/å•†æ¥­æ–½è¨­ï¼‰ã§ã‚‚ãã®ã¾ã¾ä½¿ãˆã‚‹å…±é€šèªã«ã™ã‚‹ã€‚</div>
              </div>
              <div class="actions">
                <button class="btn-outline" data-settings-action="edit">ç·¨é›†</button>
                <button class="btn-primary" data-settings-action="add">ï¼‹ è¿½åŠ </button>
              </div>
            </div>
            <div class="settings-example">ä¾‹ï¼šå®¢å®¤ / è„±è¡£æ‰€ / ãƒ­ãƒƒã‚«ãƒ¼å‰ / å—ä»˜å‰ / é§è»Šå ´ / ãƒˆã‚¤ãƒ¬ / ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³</div>
            <div class="settings-content">
              <div class="settings-table">
                <table>
                  <thead>
                    <tr>
                      <th>label</th>
                      <th>area</th>
                      <th>sort_order</th>
                      <th>is_active</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="settingsPickupBody"></tbody>
                </table>
              </div>
              <div class="settings-side">
                <div class="settings-box">
                  <h3>ç·¨é›†ã§ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</h3>
                  <div class="field-list">
                    <span class="field-chip required">labelï¼ˆå¿…é ˆï¼‰</span>
                    <span class="field-chip">areaï¼ˆä»»æ„ï¼‰</span>
                    <span class="field-chip">sort_order</span>
                    <span class="field-chip">is_active</span>
                  </div>
                </div>
                <div class="settings-box">
                  <h3>é‹ç”¨ãƒ¡ãƒ¢</h3>
                  <p>é¤¨å†…ã‚¨ãƒªã‚¢ã¯ã€Œ1F/2Fã€ã€Œæ±è¥¿ã€ã€Œå±‹å¤–ã€ãªã©ç²’åº¦ã‚’æƒãˆã‚‹ã¨æ¤œç´¢ãŒå®‰å®šã—ã¾ã™ã€‚</p>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-panel" data-settings-panel="storage">
            <div class="settings-panel-head">
              <div>
                <div class="settings-panel-title">ä¿ç®¡å ´æ‰€ï¼ˆStorageLocationï¼‰</div>
                <div class="settings-panel-sub">ç®¡ç†ç•ªå·æ¡ç•ªï¼ˆcode_prefixï¼‰ã¨æœŸé™ï¼ˆdefault_retention_daysï¼‰ã«ç›´çµã€‚</div>
              </div>
              <div class="actions">
                <button class="btn-outline" data-settings-action="edit">ç·¨é›†</button>
                <button class="btn-primary" data-settings-action="add">ï¼‹ è¿½åŠ </button>
              </div>
            </div>
            <div class="settings-example">ä¾‹ï¼šãƒ•ãƒ­ãƒ³ãƒˆæ£šB-2 / å€‰åº«A-3</div>
            <div class="settings-content">
              <div class="settings-table">
                <table>
                  <thead>
                    <tr>
                      <th>name</th>
                      <th>area_type</th>
                      <th>code_prefix</th>
                      <th>default_retention_days</th>
                      <th>sort_order</th>
                      <th>is_active</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="settingsStorageBody"></tbody>
                </table>
              </div>
              <div class="settings-side">
                <div class="settings-box">
                  <h3>ç·¨é›†ã§ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</h3>
                  <div class="field-list">
                    <span class="field-chip required">nameï¼ˆå¿…é ˆï¼‰</span>
                    <span class="field-chip">area_typeï¼ˆå€‰åº«/ãƒ•ãƒ­ãƒ³ãƒˆæ£š/ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰/ãã®ä»–ï¼‰</span>
                    <span class="field-chip required">code_prefixï¼ˆå¿…é ˆï¼‰</span>
                    <span class="field-chip">default_retention_daysï¼ˆä»»æ„ï¼‰</span>
                    <span class="field-chip">sort_order</span>
                    <span class="field-chip">is_active</span>
                  </div>
                </div>
                <div class="settings-box">
                  <h3>é‹ç”¨ãƒ¡ãƒ¢</h3>
                  <p>default_retention_days ãŒæœªè¨­å®šãªã‚‰ Facility ã®æœŸé™è¨­å®šã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚</p>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-panel" data-settings-panel="category">
            <div class="settings-panel-head">
              <div>
                <div class="settings-panel-title">ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ï¼ˆCategoryMasterï¼‰</div>
                <div class="settings-panel-sub">ãƒ™ãƒ¼ã‚¹ã‚«ãƒ†ã‚´ãƒªã¯å›ºå®šã§ã‚‚ã€è¡¨ç¤ºãƒ©ãƒ™ãƒ«ã¨ä¸¦ã³é †ã‚’æ–½è¨­ã§èª¿æ•´ã§ãã¾ã™ã€‚</div>
              </div>
              <div class="actions">
                <button class="btn-outline" data-settings-action="edit">ç·¨é›†</button>
                <button class="btn-primary" data-settings-action="add">ï¼‹ è¿½åŠ </button>
              </div>
            </div>
            <div class="settings-example">ãƒ™ãƒ¼ã‚¹ã‚«ãƒ†ã‚´ãƒªã¯å›ºå®šã€‚è¡¨ç¤ºãƒ©ãƒ™ãƒ«ã¨ä¸¦ã³é †ã ã‘æ–½è¨­ã§æœ€é©åŒ–ã€‚</div>
            <div class="settings-content">
              <div class="settings-table">
                <table>
                  <thead>
                    <tr>
                      <th>base_category</th>
                      <th>label</th>
                      <th>icon_emoji</th>
                      <th>sort_order</th>
                      <th>is_active</th>
                      <th>æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="settingsCategoryBody"></tbody>
                </table>
              </div>
              <div class="settings-side">
                <div class="settings-box">
                  <h3>ç·¨é›†ã§ãã‚‹ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰</h3>
                  <div class="field-list">
                    <span class="field-chip">base_categoryï¼ˆå›ºå®šï¼‰</span>
                    <span class="field-chip">label</span>
                    <span class="field-chip">icon_emojiï¼ˆä»»æ„ï¼‰</span>
                    <span class="field-chip">sort_order</span>
                    <span class="field-chip">is_active</span>
                  </div>
                </div>
                <div class="settings-box">
                  <h3>é‹ç”¨ãƒ¡ãƒ¢</h3>
                  <p>ãƒœã‚¿ãƒ³è¡¨ç¤ºåã¯ç¾å ´ã®å‘¼ã³æ–¹ã«åˆã‚ã›ã€ã‚¢ã‚¤ã‚³ãƒ³ã§è¦–èªæ€§ã‚’ä¸Šã’ã¾ã™ã€‚</p>
                </div>
              </div>
            </div>
          </div>

          <div class="settings-later">
            <div class="settings-later-card">
              <div class="settings-later-tag">å¾Œå›ã—</div>
              <div class="settings-later-title">ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†</div>
              <div class="settings-later-note">å½¹å‰²ã¨æ¨©é™ã€æ‹›å¾…ãƒ•ãƒ­ãƒ¼ã¯æ¬¡æ®µéšã§æ‹¡å¼µã€‚</div>
            </div>
            <div class="settings-later-card">
              <div class="settings-later-tag">å¾Œå›ã—</div>
              <div class="settings-later-title">æ–½è¨­è¨­å®š</div>
              <div class="settings-later-note">ä¿ç®¡æœŸé™ã®åŸºæº–å€¤ãƒ»é€šçŸ¥ãƒ«ãƒ¼ãƒ«ã‚’ç®¡ç†ã€‚</div>
            </div>
          </div>
        </div>
      </div>

      <div id="viewContact" style="display:none; margin-top:12px;">
        <div class="contact-shell">
          <div class="contact-panel">
            <div class="contact-list-header">
              <div>
                <div class="contact-list-title">å•ã„åˆã‚ã›ã‚±ãƒ¼ã‚¹ï¼ˆContactCaseï¼‰</div>
                <div class="contact-list-sub">å•ã„åˆã‚ã›å¯¾å¿œã®é€²æ—ã‚’ã€Œæ¡ˆä»¶ã€ã¨ã—ã¦ä¿æŒã—ã¾ã™ã€‚</div>
              </div>
              <button class="btn-primary" id="contactNewBtn">ï¼‹ å•ã„åˆã‚ã›</button>
            </div>
            <div class="contact-filter">
              <div class="pills" id="contactStatusFilters">
                <div class="pill active" data-status="all">ã™ã¹ã¦</div>
                <div class="pill" data-status="å¯¾å¿œä¸­">å¯¾å¿œä¸­</div>
                <div class="pill" data-status="ä¸€è‡´ãƒ»è¿”å´äºˆå®š">ä¸€è‡´ãƒ»è¿”å´äºˆå®š</div>
                <div class="pill" data-status="è¦‹ã¤ã‹ã‚‰ãš">è¦‹ã¤ã‹ã‚‰ãš</div>
                <div class="pill" data-status="ã‚¯ãƒ­ãƒ¼ã‚º">ã‚¯ãƒ­ãƒ¼ã‚º</div>
              </div>
              <div class="input">
                <span class="icon">ğŸ”</span>
                <input id="contactSearch" type="text" placeholder="ç®¡ç†ç•ªå·ãƒ»é›»è©±ãƒ»ç‰¹å¾´ã§æ¤œç´¢">
              </div>
            </div>
            <div class="contact-meta" id="contactMetaText">å…¨ 0ä»¶ / è¡¨ç¤º 0ä»¶</div>
            <div class="contact-list" id="contactList"></div>
          </div>

          <div class="contact-panel" id="contactDetail"></div>
        </div>
      </div>

      <div id="viewMatch" style="display:none; margin-top:12px;">
        <div class="match-layout">
          <div class="match-left">
            <h3 style="margin:0 0 8px; font-size:16px; color:var(--heading);">èãå–ã‚Šãƒ¡ãƒ¢</h3>
            <div class="field">
              <div class="label">ãŠå®¢æ§˜åï¼ˆä»»æ„ï¼‰</div>
              <input id="matchName" type="text" placeholder="å±±ç”°æ§˜ ãªã©">
            </div>
            <div class="field">
              <div class="label">å®¿æ³Šæ—¥ï¼ˆFromã€œToï¼‰</div>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <input id="matchStayFrom" type="date">
                <input id="matchStayTo" type="date">
              </div>
            </div>
            <div class="field">
              <div class="label">éƒ¨å±‹ç•ªå·</div>
              <input id="matchRoom" type="text" placeholder="ä¾‹ï¼‰301å·å®¤ ãªã©">
              <div class="pills" id="roomPills" style="margin-top:6px; flex-wrap:wrap;"></div>
            </div>
            <div class="field">
              <div class="label">ã‚«ãƒ†ã‚´ãƒª</div>
              <select id="matchCategory">
                <option value="all">ã™ã¹ã¦</option>
                <option>è²¡å¸ƒ</option><option>ã‚«ãƒãƒ³</option><option>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</option><option>å……é›»å™¨</option><option>éµ</option><option>è¡£é¡</option><option>ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³å°ç‰©</option><option>ãƒ¡ã‚¬ãƒ</option><option>åŒ–ç²§å“</option><option>é´</option><option>å‚˜</option><option>ãã®ä»–</option>
              </select>
            </div>
            <div class="field">
              <div class="label">è‰²ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»ç‰¹å¾´</div>
              <textarea id="matchKeyword" placeholder="ä¾‹ï¼‰é»’ã„é•·è²¡å¸ƒ / COACH / é€æ˜ã‚±ãƒ¼ã‚¹ ãªã©"></textarea>
            </div>
          <div class="field">
            <div class="label">èãå–ã£ãŸã“ã¨ã®ãƒ¡ãƒ¢</div>
            <textarea id="matchNote" placeholder="é›»è©±ä¸­ã®ãƒ¡ãƒ¢ã‚’æ®‹ã›ã¾ã™"></textarea>
          </div>
            <div class="label" style="margin-top:6px; font-weight:700; color:var(--heading);">çµã‚Šè¾¼ã¿çµæœï¼š<span id="matchCount">0ä»¶</span></div>
          </div>
        <div class="match-center">
          <div class="match-meta"><span>å€™è£œ <span id="matchMetaText"></span></span><span style="color:var(--muted); font-size:12px;">ç™ºè¦‹æ—¥ã®æ–°ã—ã„é †</span></div>
          <div id="matchGrid" class="match-grid"></div>
        </div>
        <div class="match-right">
          <div id="matchDetail" class="match-detail">
            <div class="match-photo-wrap">
              <img id="matchPhoto" class="match-photo" alt="">
            </div>
            <div class="match-detail-body">
              <div class="detail-row"><div class="detail-label">ç®¡ç†ç•ªå·</div><div id="matchId">-</div></div>
              <div class="detail-row"><div class="detail-label">ã‚«ãƒ†ã‚´ãƒª</div><div id="matchCategoryLabel">-</div></div>
              <div class="detail-row"><div class="detail-label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div><div id="matchStatus">-</div></div>
              <div class="detail-row"><div class="detail-label">ç™ºè¦‹æ—¥</div><div id="matchFound">-</div></div>
              <div class="detail-row"><div class="detail-label">å®¿æ³Šæ—¥</div><div id="matchStay">-</div></div>
              <div class="detail-row"><div class="detail-label">éƒ¨å±‹</div><div id="matchRoomDetail">-</div></div>
              <div class="detail-row"><div class="detail-label">æ‹¾å¾—å ´æ‰€</div><div id="matchPlace">-</div></div>
              <div class="detail-row"><div class="detail-label">ç‰¹å¾´</div><div id="matchFeature">-</div></div>
              <div class="detail-row"><div class="detail-label">ä¿ç®¡å ´æ‰€</div><div id="matchStorage">-</div></div>
            </div>
            <div class="detail-actions">
                <button class="btn-primary" id="matchConfirm" style="width:100%;">ãŠå®¢æ§˜ã®è½ã¨ã—ç‰©ã¨ã—ã¦ç¢ºå®š</button>
                <button class="btn-outline" id="matchExclude" style="width:100%;">å€™è£œã‹ã‚‰å¤–ã™</button>
            </div>
          </div>
        </div>
      </div>
      </div>
    </section>

    <section class="section login-preview">
      <div>
        <div class="section-heading">
          <h2>ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ï¼ˆPCï¼‰</h2>
        </div>
        <p>è–„ã„ã‚°ãƒ¬ãƒ¼èƒŒæ™¯ã«æµ®ã‹ã¶ã‚«ãƒ¼ãƒ‰ã§ã€æ¯æ—¥ã®å§‹ã¾ã‚Šã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã€‚ãƒ¡ãƒ¼ãƒ«ï¼‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ã¿ã§ã‚µã‚¯ãƒƒã¨å…¥å®¤ã€‚</p>
      </div>
      <div style="display:flex; justify-content:flex-end;">
        <div class="login-card">
          <div class="brand" style="justify-content:center; gap:10px;">
            <div class="brand-mark">LC</div>
            <div style="text-align:left;">
              <div style="font-weight:800; color:var(--heading);">è½ã¨ã—ç‰©ã‚¯ãƒ©ã‚¦ãƒ‰</div>
              <small style="color:var(--muted)">ãƒ­ã‚°ã‚¤ãƒ³</small>
            </div>
          </div>
          <div class="input">
            <input type="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹">
          </div>
          <div class="input">
            <input type="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
          </div>
          <button class="btn-primary" style="width:100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
          <div class="subtle-link">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ãŠå¿˜ã‚Œã®æ–¹ã¯ã“ã¡ã‚‰</div>
        </div>
      </div>
    </section>

    <section class="section two-col">
      <div>
        <div class="section-heading">
          <h2>ãƒ¢ãƒã‚¤ãƒ«ï¼ˆæ¸…æƒãƒ»å€‰åº«å‘ã‘ï¼‰</h2>
          <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
            <p style="margin:0;">3ã‚¿ãƒƒãƒ—ã§ã‚«ãƒ¡ãƒ©ã«åˆ°é”ã€‚ãƒ¯ãƒ³ã‚¦ã‚§ã‚¤ã®ç™»éŒ²ãƒ•ãƒ­ãƒ¼ã§è¿·ã‚ã›ã¾ã›ã‚“ã€‚</p>
            <button class="btn-outline" onclick="window.location.href='mobile.html'">ãƒ¢ãƒã‚¤ãƒ«å°‚ç”¨ãƒšãƒ¼ã‚¸ã‚’é–‹ã</button>
          </div>
        </div>
        <ul style="color:var(--muted); padding-left:18px; line-height:1.7;">
          <li>ãƒ›ãƒ¼ãƒ ã¯ã€Œç™»éŒ²ã™ã‚‹ã€ã¨ã€Œç™»éŒ²ã—ãŸã‚‚ã®ã‚’ç¢ºèªã€ã®2ãƒœã‚¿ãƒ³</li>
          <li>ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã§ç¾åœ¨åœ°ã‚’æ˜ç¤º</li>
          <li>ã‚«ãƒ†ã‚´ãƒªã‚°ãƒªãƒƒãƒ‰ â†’ å†™çœŸ â†’ è©³ç´° â†’ ä¿ç®¡å ´æ‰€ã®ã‚·ãƒ³ãƒ—ãƒ«4ã‚¹ãƒ†ãƒƒãƒ—</li>
        </ul>
      </div>
      <div class="phone">
        <div class="screen">
          <div class="mobile-top">
            <span>èŠ±æœˆæ—…é¤¨ æœ¬é¤¨</span>
            <div class="stepper">
              <div class="dot active"></div>
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
          </div>
          <div id="mobileScreen"></div>
          <div class="mobile-bottom">
            <button class="btn-primary" id="mobileNext" style="width:100%; border-radius:12px;">æ¬¡ã¸</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div class="detail-overlay" id="detailOverlay"></div>
  <aside class="detail-panel" id="detailPanel" role="dialog" aria-modal="true" aria-labelledby="detailId">
    <div class="detail-head">
      <div>
        <div class="detail-id" id="detailId">A-023</div>
        <div class="pills" style="margin-top:6px;">
          <div class="pill status" id="detailCategory">è²¡å¸ƒ</div>
          <div class="badge status-stock" id="detailStatus">ä¿ç®¡ä¸­</div>
        </div>
      </div>
      <button class="btn-ghost" id="closeDetail">âœ•</button>
    </div>
    <div class="detail-tabs" id="detailTabs">
      <button class="detail-tab active" data-tab="detail">è©³ç´°</button>
      <button class="detail-tab" data-tab="history">å¯¾å¿œå±¥æ­´</button>
      <button class="detail-tab" data-tab="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†</button>
    </div>

    <div class="detail-tab-content active" data-tab-panel="detail">
      <div class="detail-photo-wrap">
        <img class="detail-photo" id="detailPhoto" alt="item">
        <span class="detail-photo-badge missing" id="detailPhotoBadge">å†™çœŸæœªç™»éŒ²</span>
      </div>
      <div class="detail-photo-note" id="detailPhotoNote">å†™çœŸãŒæœªç™»éŒ²ã®ãŸã‚ä»®ç”»åƒã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</div>
      <div class="detail-grid">
        <div class="detail-section">
          <h4>åŸºæœ¬æƒ…å ±</h4>
          <div class="detail-row">
            <div class="detail-label">ç®¡ç†ç•ªå·</div>
            <div><input class="detail-input" id="detailIdInput" type="text" readonly></div>
          </div>
          <div class="detail-row">
            <div class="detail-label">ã‚«ãƒ†ã‚´ãƒª</div>
            <div>
              <select class="detail-select" id="detailCategoryInput">
                <option>è²¡å¸ƒ</option>
                <option>ã‚«ãƒãƒ³</option>
                <option>ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³</option>
                <option>å……é›»å™¨</option>
                <option>éµ</option>
                <option>è¡£é¡</option>
                <option>ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³å°ç‰©</option>
                <option>ãƒ¡ã‚¬ãƒ</option>
                <option>åŒ–ç²§å“</option>
                <option>é´</option>
                <option>å‚˜</option>
                <option>ãã®ä»–</option>
              </select>
            </div>
          </div>
        </div>
        <div class="detail-section">
          <h4>é€²æ—</h4>
          <div class="progress-track" id="detailProgressTrack">
            <div class="progress-step" data-step="å—ä»˜">å—ä»˜</div>
            <div class="progress-step" data-step="ä¿ç®¡">ä¿ç®¡</div>
            <div class="progress-step" data-step="é€£çµ¡">é€£çµ¡</div>
            <div class="progress-step" data-step="å®Œäº†">å®Œäº†</div>
          </div>
          <div class="detail-row">
            <div class="detail-label">é€²æ—ã‚¹ãƒ†ãƒ¼ã‚¸</div>
            <div>
              <select class="detail-select" id="detailProgressInput">
                <option>å—ä»˜</option>
                <option>ä¿ç®¡</option>
                <option>é€£çµ¡</option>
                <option>å®Œäº†</option>
              </select>
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-label">æœ€çµ‚æ›´æ–°</div>
            <div class="detail-meta-text" id="detailProgressUpdated">-</div>
          </div>
        </div>
        <div class="detail-section">
          <h4>å ´æ‰€ãƒ»æ—¥ä»˜</h4>
          <div class="detail-row">
            <div class="detail-label">ç™ºè¦‹æ—¥</div>
            <div><input class="detail-input" id="detailFoundInput" type="date"></div>
          </div>
          <div class="detail-row">
            <div class="detail-label">å®¿æ³Šæ—¥</div>
            <div><input class="detail-input" id="detailStayInput" type="date"></div>
          </div>
          <div class="detail-row">
            <div class="detail-label">æ‹¾å¾—å ´æ‰€</div>
            <div><input class="detail-input" id="detailPlaceInput" type="text"></div>
          </div>
          <div class="detail-row">
            <div class="detail-label">éƒ¨å±‹ç•ªå·</div>
            <div><input class="detail-input" id="detailRoomInput" type="text"></div>
          </div>
        </div>
        <div class="detail-section">
          <h4>ç‰¹å¾´</h4>
          <div class="detail-row">
            <div class="detail-label">è‰² / ãƒ–ãƒ©ãƒ³ãƒ‰</div>
            <div class="detail-duo">
              <input class="detail-input" id="detailColorInput" type="text" placeholder="è‰²">
              <input class="detail-input" id="detailBrandInput" type="text" placeholder="ãƒ–ãƒ©ãƒ³ãƒ‰">
            </div>
          </div>
          <div class="detail-row">
            <div class="detail-label">ç‰¹å¾´</div>
            <div><textarea class="detail-textarea" id="detailFeatureInput" placeholder="ç‰¹å¾´ã‚„è£œè¶³"></textarea></div>
          </div>
        </div>
        <div class="detail-section">
          <h4>ä¿ç®¡ãƒ»æœŸé™</h4>
          <div class="detail-row">
            <div class="detail-label">ä¿ç®¡å ´æ‰€</div>
            <div><input class="detail-input" id="detailStorageInput" type="text"></div>
          </div>
          <div class="detail-row">
            <div class="detail-label">ä¿ç®¡æœŸé™</div>
            <div>
              <input class="detail-input" id="detailDeadlineInput" type="date">
              <div class="detail-help" id="detailDeadlineHelp"></div>
            </div>
          </div>
        </div>
        <div class="detail-section">
          <h4>ãŠå®¢æ§˜æƒ…å ±</h4>
          <div class="detail-row">
            <div class="detail-label">é¡§å®¢æƒ…å ±</div>
            <div><input class="detail-input" id="detailCustomerInput" type="text" placeholder="ä¾‹ï¼‰å±±ç”°æ§˜ / é€£çµ¡å…ˆ"></div>
          </div>
        </div>
      </div>
      <div class="detail-edit-actions">
        <button class="btn-primary" id="saveDetail">å¤‰æ›´ã‚’ä¿å­˜</button>
        <button class="btn-outline" id="resetDetail">å¤‰æ›´ã‚’ç ´æ£„</button>
      </div>
    </div>

    <div class="detail-tab-content" data-tab-panel="history">
      <div class="detail-section">
        <h4>å¯¾å¿œå±¥æ­´ï¼ˆé¡§å®¢é€£çµ¡ï¼‰</h4>
        <div class="history-list" id="detailHistoryList"></div>
        <div class="detail-row">
          <div class="detail-label">å¯¾å¿œç¨®åˆ¥</div>
          <div>
            <select class="detail-select" id="detailHistoryType">
              <option>ãƒ¡ãƒ¢</option>
              <option>é›»è©±</option>
              <option>ãƒ¡ãƒ¼ãƒ«</option>
              <option>SMS</option>
              <option>æ¥é¤¨</option>
              <option>éƒµé€</option>
            </select>
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-label">å†…å®¹</div>
          <div><textarea class="detail-textarea" id="detailHistoryNote" placeholder="é€£çµ¡å†…å®¹ã‚„å¯¾å¿œãƒ¡ãƒ¢ã‚’è¨˜éŒ²"></textarea></div>
        </div>
        <div class="history-actions">
          <button class="btn-outline" id="addHistory">å±¥æ­´ã‚’è¿½åŠ </button>
          <button class="btn-ghost" id="clearHistoryInput">å…¥åŠ›ã‚¯ãƒªã‚¢</button>
        </div>
      </div>
    </div>

    <div class="detail-tab-content" data-tab-panel="status">
      <div class="detail-section">
        <h4>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†</h4>
        <div class="detail-row">
          <div class="detail-label">ç¾åœ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
          <div>
            <select class="detail-select" id="detailStatusInput">
              <option>ä¿ç®¡ä¸­</option>
              <option>æœŸé™é–“è¿‘</option>
              <option>æœŸé™åˆ‡ã‚Œ</option>
              <option>è¿”å´æ¸ˆ</option>
              <option>è­¦å¯Ÿå¼•æ¸¡ã—</option>
              <option>å»ƒæ£„æ¸ˆ</option>
            </select>
          </div>
        </div>
        <div class="detail-row">
          <div class="detail-label">æ›´æ–°ãƒ¡ãƒ¢</div>
          <div><textarea class="detail-textarea" id="detailStatusNote" placeholder="æ›´æ–°ç†ç”±ã‚„å¼•ãç¶™ããƒ¡ãƒ¢"></textarea></div>
        </div>
        <div class="history-actions">
          <button class="btn-outline" id="recordStatus">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨˜éŒ²</button>
          <button class="btn-ghost" id="clearStatusNote">ãƒ¡ãƒ¢ã‚’ã‚¯ãƒªã‚¢</button>
        </div>
        <div class="detail-row">
          <div class="detail-label">æœ€çµ‚æ›´æ–°</div>
          <div class="detail-meta-text" id="detailStatusUpdated">-</div>
        </div>
        <div class="detail-meta-text">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å±¥æ­´</div>
        <div class="history-list" id="detailStatusHistoryList"></div>
        <div class="detail-help">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã¨ãƒ¡ãƒ¢ã¯ã“ã“ã§è¨˜éŒ²ï¼ˆå¯¾å¿œå±¥æ­´ã¨ã¯åˆ¥ï¼‰</div>
      </div>
      <div class="detail-actions">
        <button class="btn-ghost" data-update="å»ƒæ£„æ¸ˆ" style="color:#DC2626;">å»ƒæ£„æ¸ˆã¨ã—ã¦è¨˜éŒ²</button>
        <button class="btn-primary" data-update="è¿”å´æ¸ˆ">è¿”å´æ¸ˆã¨ã—ã¦è¨˜éŒ²</button>
        <button class="btn-ghost" data-update="è­¦å¯Ÿå¼•æ¸¡ã—">è­¦å¯Ÿã«å¼•ãæ¸¡ã—</button>
      </div>
    </div>
  </aside>

  <div class="settings-modal-overlay" id="settingsModalOverlay"></div>
  <aside class="settings-modal" id="settingsModal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
    <div class="settings-modal-head">
      <div class="settings-modal-title-group">
        <div class="settings-modal-eyebrow">è¨­å®šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ</div>
        <div class="settings-modal-title" id="settingsModalTitle">è¨­å®šã‚’è¿½åŠ </div>
        <div class="settings-modal-sub" id="settingsModalSub">å…¥åŠ›å†…å®¹ã‚’ä¿å­˜ã—ã¦ãƒ†ãƒ¼ãƒ–ãƒ«ã«åæ˜ ã—ã¾ã™ã€‚</div>
      </div>
      <button class="btn-ghost" id="settingsModalClose">âœ•</button>
    </div>
    <div class="settings-modal-body" id="settingsModalBody"></div>
    <div class="settings-modal-actions">
      <button class="btn-ghost" id="settingsModalCancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      <button class="btn-primary" id="settingsModalSave">ä¿å­˜</button>
    </div>
  </aside>

  <div class="toast" id="toast">æ›´æ–°ã—ã¾ã—ãŸ</div>

  <footer>Â© è½ã¨ã—ç‰©ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆä»®ï¼‰ â€” â€œæ—…é¤¨ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰ã®ç›¸æ£’â€</footer>

  <script>
    const data = [
      {
        id: 'A-023',
        category: 'è²¡å¸ƒ',
        date: '2025-03-15',
        stay: '2025-03-14',
        place: '301å·å®¤ / ãƒ™ãƒƒãƒ‰ä»˜è¿‘',
        room: '301',
        storage: 'å€‰åº«A-3',
        status: 'ä¿ç®¡ä¸­',
        statusUpdated: '2025-03-15 18:20',
        statusHistory: [
          { at: '2025-03-15 18:20', status: 'ä¿ç®¡ä¸­', note: 'å€‰åº«A-3ã«ä¿ç®¡' },
          { at: '2025-03-15 10:20', status: 'ä¿ç®¡ä¸­', note: 'æ¸…æƒã‚¹ã‚¿ãƒƒãƒ•ã‚ˆã‚Šå—é ˜' }
        ],
        deadline: '2025-04-30',
        daysLeft: 45,
        color: 'é»’',
        brand: 'ã‚µãƒ ã‚½ãƒŠã‚¤ãƒˆ',
        feature: 'é»’ã„é•·è²¡å¸ƒ / é‡‘è‰²ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼',
        image: 'https://images.unsplash.com/photo-1523275335684-37898b6baf30?auto=format&fit=crop&w=600&q=80',
        progress: 'ä¿ç®¡',
        progressUpdated: '2025-03-15 18:20',
        history: []
      },
      {
        id: 'B-144',
        category: 'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³',
        date: '2025-03-14',
        stay: '2025-03-13',
        place: 'å¤§æµ´å ´ ãƒ­ãƒƒã‚«ãƒ¼å‰',
        room: '-',
        storage: 'ãƒ•ãƒ­ãƒ³ãƒˆæ£šB-2',
        status: 'æœŸé™é–“è¿‘',
        statusUpdated: '2025-03-16 09:10',
        statusHistory: [
          { at: '2025-03-16 09:10', status: 'æœŸé™é–“è¿‘', note: 'ä¿ç®¡æœŸé™ã®7æ—¥å‰ã‚’ç¢ºèª' }
        ],
        deadline: '2025-03-22',
        daysLeft: 7,
        color: 'ãƒ–ãƒ«ãƒ¼',
        brand: 'iPhone 13',
        feature: 'é’ã„ã‚±ãƒ¼ã‚¹ / ç”»é¢å‰²ã‚Œãªã—',
        image: 'https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?auto=format&fit=crop&w=600&q=80',
        progress: 'é€£çµ¡',
        progressUpdated: '2025-03-16 09:10',
        history: [
          { at: '2025-03-15 12:05', type: 'é›»è©±', note: 'å®¿æ³Šè€…ã«é€£çµ¡ã€æŠ˜ã‚Šè¿”ã—å¾…ã¡' }
        ]
      },
      {
        id: 'C-078',
        category: 'éµ',
        date: '2025-03-10',
        stay: '2025-03-10',
        place: 'ãƒ­ãƒ“ãƒ¼ ã‚½ãƒ•ã‚¡',
        room: '-',
        storage: 'å€‰åº«A-1',
        status: 'æœŸé™åˆ‡ã‚Œ',
        statusUpdated: '2025-03-17 17:30',
        statusHistory: [
          { at: '2025-03-17 17:30', status: 'æœŸé™åˆ‡ã‚Œ', note: 'æœŸé™åˆ‡ã‚Œã®ãŸã‚å¯¾å¿œç¢ºèª' }
        ],
        deadline: '2025-03-17',
        daysLeft: -3,
        color: 'ã‚·ãƒ«ãƒãƒ¼',
        brand: 'MIWA',
        feature: 'ã‚­ãƒ¼ã‚¿ã‚°ã€Œé’ã€ä»˜ã',
        image: 'https://images.unsplash.com/photo-1505691938895-1758d7feb511?auto=format&fit=crop&w=600&q=80',
        progress: 'å®Œäº†',
        progressUpdated: '2025-03-17 17:30',
        history: []
      },
      {
        id: 'D-011',
        category: 'å‚˜',
        date: '2025-03-15',
        stay: '',
        place: 'ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³å…¥ã‚Šå£',
        room: '-',
        storage: 'ãƒ•ãƒ­ãƒ³ãƒˆå‚˜ç«‹ã¦',
        status: 'ä¿ç®¡ä¸­',
        statusUpdated: '2025-03-15 20:00',
        statusHistory: [
          { at: '2025-03-15 20:00', status: 'ä¿ç®¡ä¸­', note: 'ãƒ•ãƒ­ãƒ³ãƒˆå‚˜ç«‹ã¦ã«ç§»å‹•' }
        ],
        deadline: '2025-04-05',
        daysLeft: 20,
        color: 'èµ¤',
        brand: '-',
        feature: 'èµ¤ã„æŠ˜ã‚ŠãŸãŸã¿å‚˜',
        image: '',
        progress: 'ä¿ç®¡',
        progressUpdated: '2025-03-15 20:00',
        history: []
      },
      {
        id: 'E-032',
        category: 'è¡£é¡',
        date: '2025-03-12',
        stay: '',
        place: 'å¤§æµ´å ´ è„±è¡£æ‰€',
        room: '-',
        storage: 'å€‰åº«B-1',
        status: 'è¿”å´æ¸ˆ',
        statusUpdated: '2025-03-13 15:40',
        statusHistory: [
          { at: '2025-03-13 15:40', status: 'è¿”å´æ¸ˆ', note: 'æ¥é¤¨ã«ã¦è¿”å´' }
        ],
        deadline: '2025-03-25',
        daysLeft: 10,
        color: 'ãƒ™ãƒ¼ã‚¸ãƒ¥',
        brand: 'ãƒ¦ãƒ‹ã‚¯ãƒ­',
        feature: 'ãƒ™ãƒ¼ã‚¸ãƒ¥ã®ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³',
        image: 'https://images.unsplash.com/photo-1521572267360-ee0c2909d518?auto=format&fit=crop&w=600&q=80',
        progress: 'å®Œäº†',
        progressUpdated: '2025-03-13 15:40',
        history: [
          { at: '2025-03-13 15:40', type: 'æ¥é¤¨', note: 'æ¥é¤¨ã«ã¦è¿”å´' }
        ]
      },
      {
        id: 'F-204',
        category: 'åŒ–ç²§å“',
        date: '2025-03-16',
        stay: '',
        place: 'å®¢å®¤ 502',
        room: '502',
        storage: 'å€‰åº«C-2',
        status: 'æœŸé™é–“è¿‘',
        statusUpdated: '2025-03-16 11:15',
        statusHistory: [
          { at: '2025-03-16 11:15', status: 'æœŸé™é–“è¿‘', note: 'æœŸé™ã‚¢ãƒ©ãƒ¼ãƒˆã§ç¢ºèª' }
        ],
        deadline: '2025-03-23',
        daysLeft: 6,
        color: 'ãƒ”ãƒ³ã‚¯',
        brand: 'SHISEIDO',
        feature: 'ãƒãƒ¼ãƒã«å£ç´…3æœ¬',
        image: 'https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9?auto=format&fit=crop&w=600&q=80',
        progress: 'é€£çµ¡',
        progressUpdated: '2025-03-16 11:15',
        history: [
          { at: '2025-03-16 11:15', type: 'ãƒ¡ãƒ¼ãƒ«', note: 'é€£çµ¡å…ˆå®›ã«æ¡ˆå†…ãƒ¡ãƒ¼ãƒ«é€ä»˜' }
        ]
      },
      {
        id: 'G-099',
        category: 'é´',
        date: '2025-03-09',
        stay: '2025-03-08',
        place: 'ã‚¨ãƒ¬ãƒ™ãƒ¼ã‚¿ãƒ¼å‰',
        room: '-',
        storage: 'å€‰åº«A-5',
        status: 'æœŸé™åˆ‡ã‚Œ',
        statusUpdated: '2025-03-16 09:00',
        statusHistory: [
          { at: '2025-03-16 09:00', status: 'æœŸé™åˆ‡ã‚Œ', note: 'æœŸé™åˆ‡ã‚Œã‚’ç¢ºèª' }
        ],
        deadline: '2025-03-16',
        daysLeft: -4,
        color: 'ç™½',
        brand: 'NIKE',
        feature: 'ç™½ã®ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼ 27cm',
        image: 'https://images.unsplash.com/photo-1528701800489-20be9f3c0341?auto=format&fit=crop&w=600&q=80',
        progress: 'ä¿ç®¡',
        progressUpdated: '2025-03-09 18:05',
        history: []
      },
      {
        id: 'H-055',
        category: 'å……é›»å™¨',
        date: '2025-03-16',
        stay: '',
        place: 'ãƒ­ãƒ“ãƒ¼ ã‚³ãƒ³ã‚»ãƒ³ãƒˆ',
        room: '-',
        storage: 'ãƒ•ãƒ­ãƒ³ãƒˆæ£šA-1',
        status: 'ä¿ç®¡ä¸­',
        statusUpdated: '2025-03-16 14:12',
        statusHistory: [
          { at: '2025-03-16 14:12', status: 'ä¿ç®¡ä¸­', note: 'ãƒ•ãƒ­ãƒ³ãƒˆæ£šA-1ã«ä¿ç®¡' }
        ],
        deadline: '2025-04-04',
        daysLeft: 19,
        color: 'ç™½',
        brand: 'Anker',
        feature: 'ç™½ã„USB-Cã‚±ãƒ¼ãƒ–ãƒ«ä»˜ã',
        image: 'https://images.unsplash.com/photo-1582719478250-c89cae4dc85b?auto=format&fit=crop&w=600&q=80',
        progress: 'ä¿ç®¡',
        progressUpdated: '2025-03-16 14:12',
        history: []
      }
    ];

    const fallbackImage = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='600' height='400' viewBox='0 0 600 400'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0' x2='1' y1='0' y2='1'%3E%3Cstop offset='0%25' stop-color='%23E2E8F0'/%3E%3Cstop offset='100%25' stop-color='%23F8FAFC'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='600' height='400' rx='28' fill='url(%23g)'/%3E%3Crect x='120' y='90' width='360' height='220' rx='24' fill='%23FFFFFF' stroke='%23CBD5E1' stroke-width='2'/%3E%3Ccircle cx='230' cy='180' r='28' fill='%23E2E8F0'/%3E%3Cpath d='M200%20260L280%20190L350%20245L410%20200L460%20260' stroke='%23CBD5E1' stroke-width='8' fill='none' stroke-linecap='round' stroke-linejoin='round'/%3E%3Ctext x='300' y='325' text-anchor='middle' font-family='Arial,sans-serif' font-size='20' fill='%2394A3B8'%3ENO%20PHOTO%3C/text%3E%3C/svg%3E";
    const hasImage = (item) => !!(item && item.image && String(item.image).trim());
    const resolveImage = (item) => (hasImage(item) ? item.image : fallbackImage);

    const contactCases = [
      {
        id: 'CC-102',
        facility: 'èŠ±æœˆæ—…é¤¨ãƒ»æœ¬é¤¨',
        account: 'å±±ç”°',
        status: 'å¯¾å¿œä¸­',
        channel: 'é›»è©±',
        feature_text: 'é»’ã„é•·è²¡å¸ƒã€‚301å·å®¤ã«å®¿æ³Šã€‚é‡‘è‰²ã®ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼ãŒä»˜ã„ã¦ã„ã‚‹ã€‚',
        stay_date: '2025-03-14',
        room_number: '301',
        contact_phone: '090-1234-5678',
        contact_email: '',
        matched_lost_item_id: '',
        shipping: { tracking_number: '', shipped_at: '', shipping_note: '' },
        created_at: '2025-03-16 09:20',
        updated_at: '2025-03-16 09:20'
      },
      {
        id: 'CC-103',
        facility: 'èŠ±æœˆæ—…é¤¨ãƒ»æœ¬é¤¨',
        account: 'ä½è—¤',
        status: 'ä¸€è‡´ãƒ»è¿”å´äºˆå®š',
        channel: 'LINE',
        feature_text: 'é’ã„ã‚¹ãƒãƒ›ã‚±ãƒ¼ã‚¹ã€‚ãƒ­ãƒƒã‚«ãƒ¼å‰ã§è½ã¨ã—ãŸã¨ã®ã“ã¨ã€‚',
        stay_date: '2025-03-13',
        room_number: '',
        contact_phone: '',
        contact_email: 'sato@example.com',
        matched_lost_item_id: 'B-144',
        shipping: { tracking_number: 'JP1234-5678-9012', shipped_at: '2025-03-17', shipping_note: 'ã‚†ã†ãƒ‘ãƒƒã‚¯ã§ç™ºé€äºˆå®š' },
        created_at: '2025-03-16 11:05',
        updated_at: '2025-03-17 09:30'
      },
      {
        id: 'CC-104',
        facility: 'èŠ±æœˆæ—…é¤¨ãƒ»æœ¬é¤¨',
        account: 'é«˜æ©‹',
        status: 'è¦‹ã¤ã‹ã‚‰ãš',
        channel: 'ãƒ¡ãƒ¼ãƒ«',
        feature_text: 'ç™½ã„ã‚¹ãƒ‹ãƒ¼ã‚«ãƒ¼ã€‚ã‚µã‚¤ã‚º27cmã€‚å®¿æ³Šæ—¥ã¯ä¸æ˜ã€‚',
        stay_date: '',
        room_number: '',
        contact_phone: '',
        contact_email: 'takahashi@example.com',
        matched_lost_item_id: '',
        shipping: { tracking_number: '', shipped_at: '', shipping_note: '' },
        created_at: '2025-03-15 18:40',
        updated_at: '2025-03-16 10:00'
      }
    ];

    const tableBody = document.getElementById('tableBody');
    const detailPanel = document.getElementById('detailPanel');
    const detailOverlay = document.getElementById('detailOverlay');
    const detailPhoto = document.getElementById('detailPhoto');
    const detailPhotoBadge = document.getElementById('detailPhotoBadge');
    const detailPhotoNote = document.getElementById('detailPhotoNote');
    const toast = document.getElementById('toast');
    const detailForm = {
      id: document.getElementById('detailIdInput'),
      category: document.getElementById('detailCategoryInput'),
      status: document.getElementById('detailStatusInput'),
      statusNote: document.getElementById('detailStatusNote'),
      statusUpdated: document.getElementById('detailStatusUpdated'),
      statusHistoryList: document.getElementById('detailStatusHistoryList'),
      progress: document.getElementById('detailProgressInput'),
      progressUpdated: document.getElementById('detailProgressUpdated'),
      found: document.getElementById('detailFoundInput'),
      stay: document.getElementById('detailStayInput'),
      place: document.getElementById('detailPlaceInput'),
      room: document.getElementById('detailRoomInput'),
      color: document.getElementById('detailColorInput'),
      brand: document.getElementById('detailBrandInput'),
      feature: document.getElementById('detailFeatureInput'),
      storage: document.getElementById('detailStorageInput'),
      deadline: document.getElementById('detailDeadlineInput'),
      deadlineHelp: document.getElementById('detailDeadlineHelp'),
      customer: document.getElementById('detailCustomerInput'),
      historyList: document.getElementById('detailHistoryList'),
      historyType: document.getElementById('detailHistoryType'),
      historyNote: document.getElementById('detailHistoryNote')
    };

    let currentItem = null;
    let originalItem = null;
    const progressStages = ['å—ä»˜', 'ä¿ç®¡', 'é€£çµ¡', 'å®Œäº†'];
    const progressSteps = Array.from(document.querySelectorAll('#detailProgressTrack .progress-step'));
    const detailTabs = Array.from(document.querySelectorAll('#detailTabs .detail-tab'));
    const detailTabPanels = Array.from(document.querySelectorAll('[data-tab-panel]'));

    const badgeClass = (status) => {
      if (status === 'ä¿ç®¡ä¸­') return 'badge status-stock';
      if (status === 'æœŸé™é–“è¿‘') return 'badge status-warning';
      if (status === 'æœŸé™åˆ‡ã‚Œ') return 'badge status-danger';
      if (status === 'å»ƒæ£„æ¸ˆ') return 'badge status-danger';
      return 'badge status-complete';
    };

    function daysLabel(days) {
      if (days === null || Number.isNaN(days)) return 'æœŸé™æœªè¨­å®š';
      if (days < 0) return `æœŸé™åˆ‡ã‚Œ (${Math.abs(days)}æ—¥è¶…é)`;
      if (days === 0) return 'æœ¬æ—¥ã¾ã§';
      return `ã‚ã¨${days}æ—¥`;
    }

    function calculateDaysLeft(dateStr) {
      if (!dateStr) return null;
      const today = new Date();
      const base = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const target = new Date(dateStr);
      if (Number.isNaN(target.getTime())) return null;
      return Math.round((target - base) / (1000 * 60 * 60 * 24));
    }

    function switchDetailTab(target) {
      detailTabs.forEach(tab => {
        tab.classList.toggle('active', tab.dataset.tab === target);
      });
      detailTabPanels.forEach(panel => {
        panel.classList.toggle('active', panel.dataset.tabPanel === target);
      });
    }

    function updateDetailHeader() {
      document.getElementById('detailId').textContent = detailForm.id.value || '-';
      document.getElementById('detailCategory').textContent = detailForm.category.value || 'æœªè¨­å®š';
      const statusEl = document.getElementById('detailStatus');
      const statusValue = (currentItem && currentItem.status) || detailForm.status.value || 'ä¿ç®¡ä¸­';
      statusEl.className = badgeClass(statusValue);
      statusEl.textContent = statusValue;
    }

    function updateDetailPhoto(item) {
      const available = hasImage(item);
      if (detailPhoto) detailPhoto.src = resolveImage(item);
      if (detailPhotoBadge) {
        detailPhotoBadge.textContent = available ? 'å†™çœŸç™»éŒ²æ¸ˆã¿' : 'å†™çœŸæœªç™»éŒ²';
        detailPhotoBadge.classList.toggle('missing', !available);
        detailPhotoBadge.classList.toggle('ready', available);
      }
      if (detailPhotoNote) {
        detailPhotoNote.textContent = available
          ? 'å†™çœŸã¯ç™»éŒ²æ¸ˆã¿ã§ã™ã€‚'
          : 'å†™çœŸãŒæœªç™»éŒ²ã®ãŸã‚ä»®ç”»åƒã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚';
      }
    }

    function updateDeadlineHelp() {
      const daysLeft = calculateDaysLeft(detailForm.deadline.value);
      detailForm.deadlineHelp.textContent = daysLeft === null ? '' : daysLabel(daysLeft);
    }

    function formatTimestamp(date = new Date()) {
      const pad = (value) => String(value).padStart(2, '0');
      const year = date.getFullYear();
      const month = pad(date.getMonth() + 1);
      const day = pad(date.getDate());
      const hours = pad(date.getHours());
      const minutes = pad(date.getMinutes());
      return `${year}-${month}-${day} ${hours}:${minutes}`;
    }

    function renderProgressTrack(stage) {
      const activeIndex = Math.max(0, progressStages.indexOf(stage));
      progressSteps.forEach((step, idx) => {
        step.classList.toggle('active', idx === activeIndex);
        step.classList.toggle('done', idx < activeIndex);
      });
    }

    function renderStatusHistory(list = []) {
      detailForm.statusHistoryList.innerHTML = '';
      if (!list.length) {
        const empty = document.createElement('div');
        empty.className = 'history-empty';
        empty.textContent = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚';
        detailForm.statusHistoryList.appendChild(empty);
        return;
      }
      list.forEach((entry) => {
        const item = document.createElement('div');
        item.className = 'history-item';
        const head = document.createElement('div');
        head.className = 'history-head';
        const badge = document.createElement('span');
        badge.className = `${badgeClass(entry.status)} history-badge`;
        badge.textContent = entry.status || 'æœªè¨­å®š';
        const time = document.createElement('div');
        time.className = 'history-time';
        time.textContent = entry.at || '-';
        const note = document.createElement('div');
        note.className = 'history-note';
        note.textContent = entry.note || 'ãƒ¡ãƒ¢ãªã—';
        head.appendChild(badge);
        head.appendChild(time);
        item.appendChild(head);
        item.appendChild(note);
        detailForm.statusHistoryList.appendChild(item);
      });
    }

    function renderHistory(list = []) {
      detailForm.historyList.innerHTML = '';
      if (!list.length) {
        const empty = document.createElement('div');
        empty.className = 'history-empty';
        empty.textContent = 'é¡§å®¢é€£çµ¡ã®å±¥æ­´ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚';
        detailForm.historyList.appendChild(empty);
        return;
      }
      list.forEach((entry) => {
        const item = document.createElement('div');
        item.className = 'history-item';
        const head = document.createElement('div');
        head.className = 'history-head';
        const type = document.createElement('div');
        type.className = 'history-type';
        type.textContent = entry.type || 'ãƒ¡ãƒ¢';
        const time = document.createElement('div');
        time.className = 'history-time';
        time.textContent = entry.at || '-';
        const note = document.createElement('div');
        note.className = 'history-note';
        note.textContent = entry.note || 'å†…å®¹ãªã—';
        head.appendChild(type);
        head.appendChild(time);
        item.appendChild(head);
        item.appendChild(note);
        detailForm.historyList.appendChild(item);
      });
    }

    function recordStatusUpdate({ status, note }) {
      if (!currentItem) return false;
      const nextStatus = status || detailForm.status.value || currentItem.status || 'ä¿ç®¡ä¸­';
      const memo = (note || '').trim();
      const hasChange = nextStatus !== currentItem.status;
      if (!hasChange && !memo) {
        showToast('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã¾ãŸã¯ãƒ¡ãƒ¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return false;
      }
      const timestamp = formatTimestamp();
      if (!Array.isArray(currentItem.statusHistory)) currentItem.statusHistory = [];
      currentItem.status = nextStatus;
      currentItem.statusUpdated = timestamp;
      currentItem.statusHistory.unshift({ at: timestamp, status: nextStatus, note: memo });
      detailForm.status.value = nextStatus;
      detailForm.statusNote.value = '';
      detailForm.statusUpdated.textContent = timestamp;
      renderStatusHistory(currentItem.statusHistory);
      if (['è¿”å´æ¸ˆ', 'è­¦å¯Ÿå¼•æ¸¡ã—', 'å»ƒæ£„æ¸ˆ'].includes(nextStatus) && currentItem.progress !== 'å®Œäº†') {
        currentItem.progress = 'å®Œäº†';
        currentItem.progressUpdated = timestamp;
        detailForm.progress.value = 'å®Œäº†';
        detailForm.progressUpdated.textContent = timestamp;
        renderProgressTrack(detailForm.progress.value);
      }
      updateDetailHeader();
      filterData();
      const row = tableBody.querySelector(`tr[data-id="${currentItem.id}"]`);
      if (row) row.classList.add('selected-row');
      originalItem = JSON.parse(JSON.stringify(currentItem));
      return true;
    }

    function fillDetailForm(item) {
      detailForm.id.value = item.id || '';
      detailForm.category.value = item.category || '';
      detailForm.status.value = item.status || 'ä¿ç®¡ä¸­';
      detailForm.statusUpdated.textContent = item.statusUpdated || (item.statusHistory && item.statusHistory[0] && item.statusHistory[0].at) || '-';
      detailForm.statusNote.value = '';
      detailForm.progress.value = progressStages.includes(item.progress) ? item.progress : progressStages[0];
      detailForm.progressUpdated.textContent = item.progressUpdated || '-';
      detailForm.found.value = item.date || '';
      detailForm.stay.value = item.stay || '';
      detailForm.place.value = item.place || '';
      detailForm.room.value = item.room || '';
      detailForm.color.value = item.color || '';
      detailForm.brand.value = item.brand || '';
      detailForm.feature.value = item.feature || '';
      detailForm.storage.value = item.storage || '';
      detailForm.deadline.value = item.deadline || '';
      detailForm.customer.value = item.customer || '';
      detailForm.historyNote.value = '';
      updateDetailHeader();
      updateDeadlineHelp();
      renderProgressTrack(detailForm.progress.value);
      renderStatusHistory(item.statusHistory || []);
      renderHistory(item.history || []);
    }

    function renderTable(list = data) {
      tableBody.innerHTML = '';
      list.forEach((item, idx) => {
        const imageSrc = resolveImage(item);
        const tr = document.createElement('tr');
        tr.dataset.id = item.id;
        tr.style.animationDelay = `${idx * 40}ms`;
        tr.innerHTML = `
          <td><img class="thumb" src="${imageSrc}" alt=""></td>
          <td style="font-weight:700;color:var(--heading);">${item.id}</td>
          <td>${item.category}</td>
          <td>${item.date}</td>
          <td>${item.stay || '-'}</td>
          <td>${item.place}</td>
          <td>${item.room || '-'}</td>
          <td>${item.storage}</td>
          <td><span class="${badgeClass(item.status)}">${item.status}</span></td>
          <td>${item.deadline} <br><small style="color:var(--muted)">${daysLabel(item.daysLeft)}</small></td>
        `;
        tr.addEventListener('click', () => {
          tableBody.querySelectorAll('tr').forEach(r => r.classList.remove('selected-row'));
          tr.classList.add('selected-row');
          openDetail(item);
        });
        tableBody.appendChild(tr);
      });
    }

    function openDetail(item) {
      currentItem = item;
      originalItem = JSON.parse(JSON.stringify(item));
      updateDetailPhoto(item);
      fillDetailForm(item);
      switchDetailTab('detail');
      detailPanel.classList.add('open');
      detailOverlay.classList.add('show');
      document.body.classList.add('modal-open');
    }

    function closeDetail() {
      detailPanel.classList.remove('open');
      detailOverlay.classList.remove('show');
      document.body.classList.remove('modal-open');
      currentItem = null;
      originalItem = null;
    }

    document.getElementById('closeDetail').addEventListener('click', closeDetail);
    detailOverlay.addEventListener('click', closeDetail);
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && detailPanel.classList.contains('open')) {
        closeDetail();
      }
    });

    detailForm.category.addEventListener('change', updateDetailHeader);
    detailForm.deadline.addEventListener('change', updateDeadlineHelp);
    detailForm.progress.addEventListener('change', () => {
      renderProgressTrack(detailForm.progress.value);
    });
    progressSteps.forEach(step => {
      step.addEventListener('click', () => {
        detailForm.progress.value = step.dataset.step;
        renderProgressTrack(detailForm.progress.value);
      });
    });
    detailTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        switchDetailTab(tab.dataset.tab);
      });
    });

    document.getElementById('recordStatus').addEventListener('click', () => {
      if (!currentItem) return;
      const recorded = recordStatusUpdate({ status: detailForm.status.value, note: detailForm.statusNote.value });
      if (recorded) showToast('ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨˜éŒ²ã—ã¾ã—ãŸ');
    });
    document.getElementById('clearStatusNote').addEventListener('click', () => {
      detailForm.statusNote.value = '';
    });

    function addHistoryEntry(entry) {
      if (!currentItem) return;
      if (!Array.isArray(currentItem.history)) currentItem.history = [];
      currentItem.history.unshift(entry);
      if (originalItem) {
        if (!Array.isArray(originalItem.history)) originalItem.history = [];
        originalItem.history.unshift(entry);
      }
      renderHistory(currentItem.history);
    }

    function saveDetail() {
      if (!currentItem) return;
      currentItem.category = detailForm.category.value.trim();
      const nextProgress = detailForm.progress.value.trim() || progressStages[0];
      if (nextProgress !== currentItem.progress) {
        currentItem.progress = nextProgress;
        currentItem.progressUpdated = formatTimestamp();
      }
      currentItem.date = detailForm.found.value;
      currentItem.stay = detailForm.stay.value;
      currentItem.place = detailForm.place.value.trim();
      currentItem.room = detailForm.room.value.trim();
      currentItem.color = detailForm.color.value.trim();
      currentItem.brand = detailForm.brand.value.trim();
      currentItem.feature = detailForm.feature.value.trim();
      currentItem.storage = detailForm.storage.value.trim();
      currentItem.deadline = detailForm.deadline.value;
      currentItem.daysLeft = calculateDaysLeft(currentItem.deadline);
      currentItem.customer = detailForm.customer.value.trim();
      updateDetailHeader();
      updateDeadlineHelp();
      renderProgressTrack(detailForm.progress.value);
      detailForm.progressUpdated.textContent = currentItem.progressUpdated || '-';
      originalItem = JSON.parse(JSON.stringify(currentItem));
      filterData();
      const row = tableBody.querySelector(`tr[data-id="${currentItem.id}"]`);
      if (row) row.classList.add('selected-row');
      showToast('ç·¨é›†å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    }

    function resetDetail() {
      if (!originalItem) return;
      fillDetailForm(originalItem);
      showToast('å¤‰æ›´ã‚’ç ´æ£„ã—ã¾ã—ãŸ');
    }

    document.getElementById('saveDetail').addEventListener('click', saveDetail);
    document.getElementById('resetDetail').addEventListener('click', resetDetail);
    document.getElementById('addHistory').addEventListener('click', () => {
      if (!currentItem) return;
      const note = detailForm.historyNote.value.trim();
      if (!note) {
        showToast('å¯¾å¿œå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        detailForm.historyNote.focus();
        return;
      }
      addHistoryEntry({
        at: formatTimestamp(),
        type: detailForm.historyType.value || 'ãƒ¡ãƒ¢',
        note
      });
      detailForm.historyNote.value = '';
      showToast('å¯¾å¿œå±¥æ­´ã‚’è¿½åŠ ã—ã¾ã—ãŸ');
    });
    document.getElementById('clearHistoryInput').addEventListener('click', () => {
      detailForm.historyNote.value = '';
    });

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 1800);
    }

    detailPanel.querySelectorAll('[data-update]').forEach(btn => {
      btn.addEventListener('click', () => {
        if (!currentItem) return;
        const actionLabel = btn.dataset.update;
        const recorded = recordStatusUpdate({
          status: actionLabel,
          note: 'ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã§æ›´æ–°'
        });
        if (recorded) {
          showToast(`${currentItem.id} ã‚’ã€Œ${actionLabel}ã€ã«æ›´æ–°ã—ã¾ã—ãŸ`);
        }
      });
    });

    // Filters
    const keyword = document.getElementById('keyword');
    const categorySelect = document.getElementById('categorySelect');
    const statusPills = Array.from(document.querySelectorAll('#statusSelect .pill'));
    const filterChips = document.getElementById('filterChips');
    const mainTabSwitch = document.getElementById('mainTabSwitch');
    const viewList = document.getElementById('viewList');
    const viewDeadline = document.getElementById('viewDeadline');
    const viewSettings = document.getElementById('viewSettings');
    const viewContact = document.getElementById('viewContact');
    const viewMatch = document.getElementById('viewMatch');
    const tableMetaText = document.getElementById('tableMetaText');

    let activeStatuses = ['ä¿ç®¡ä¸­'];
    let activeTab = 'all';
    let matchSelected = null;

    function filterData() {
      let list = [...data];
      const q = keyword.value.trim().toLowerCase();
      const category = categorySelect.value;
      if (q) {
        list = list.filter(d => {
          const values = Object.values(d).flatMap((val) => {
            if (Array.isArray(val)) {
              return val.flatMap(entry => Object.values(entry));
            }
            return [val];
          });
          return values.some((val) => {
            if (val === null || val === undefined) return false;
            if (typeof val === 'string' || typeof val === 'number') {
              return String(val).toLowerCase().includes(q);
            }
            return false;
          });
        });
      }
      if (category !== 'all') {
        list = list.filter(d => d.category === category);
      }
      if (activeStatuses.length) {
        list = list.filter(d => activeStatuses.includes(d.status));
      }
      renderTable(list);
      renderChips();
    }

    function renderChips() {
      filterChips.innerHTML = '';
      if (keyword.value) addChip(`ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰: ${keyword.value}`, () => { keyword.value=''; filterData(); });
      if (categorySelect.value !== 'all') addChip(`ã‚«ãƒ†ã‚´ãƒª: ${categorySelect.value}`, () => { categorySelect.value='all'; filterData(); });
      if (activeStatuses.length && activeStatuses.length !== statusPills.length) addChip(`ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${activeStatuses.join(', ')}`, () => { activeStatuses=['ä¿ç®¡ä¸­']; updateStatusPills(); filterData(); });
    }
    function addChip(text, onRemove) {
      const chip = document.createElement('div');
      chip.className = 'filter-chip';
      chip.textContent = text;
      const btn = document.createElement('button');
      btn.textContent = 'Ã—';
      btn.onclick = onRemove;
      chip.appendChild(btn);
      filterChips.appendChild(chip);
    }

    keyword.addEventListener('input', filterData);
    categorySelect.addEventListener('change', filterData);
    document.getElementById('clearFilters').addEventListener('click', () => {
      keyword.value = '';
      categorySelect.value = 'all';
      activeStatuses = ['ä¿ç®¡ä¸­'];
      updateStatusPills();
      filterData();
    });

    function updateStatusPills() {
      statusPills.forEach(pill => {
        const status = pill.dataset.status;
        pill.classList.toggle('active', activeStatuses.includes(status));
      });
    }

    statusPills.forEach(pill => {
      pill.addEventListener('click', () => {
        const status = pill.dataset.status;
        if (activeStatuses.includes(status)) {
          activeStatuses = activeStatuses.filter(s => s !== status);
        } else {
          activeStatuses.push(status);
        }
        if (!activeStatuses.length) activeStatuses = ['ä¿ç®¡ä¸­'];
        updateStatusPills();
        filterData();
      });
    });

    function switchMainTab(target) {
      mainTabSwitch.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      mainTabSwitch.querySelector(`[data-tab="${target}"]`).classList.add('active');
      viewList.style.display = target === 'list' ? '' : 'none';
      viewDeadline.style.display = target === 'deadline' ? '' : 'none';
      viewSettings.style.display = target === 'settings' ? '' : 'none';
      viewContact.style.display = target === 'contact' ? '' : 'none';
      viewMatch.style.display = target === 'match' ? '' : 'none';
      if (target === 'list') tableMetaText.textContent = 'å…¨ 42ä»¶ / è¡¨ç¤º 10ä»¶';
      if (target === 'deadline') tableMetaText.textContent = 'æœŸé™ã‚«ãƒ¼ãƒ‰ä¸€è¦§';
      if (target === 'settings') tableMetaText.textContent = 'è¨­å®šã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ';
      if (target === 'contact') tableMetaText.textContent = 'å•ã„åˆã‚ã›å¯¾å¿œ';
      if (target === 'match') tableMetaText.textContent = 'å†™çœŸã§ç…§åˆ';
    }

    mainTabSwitch.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        switchMainTab(tab.dataset.tab);
      });
    });

    const settingsTabSwitch = document.getElementById('settingsTabSwitch');
    const settingsPanels = Array.from(document.querySelectorAll('[data-settings-panel]'));
    let activeSettingsTab = 'pickup';

    if (settingsTabSwitch) {
      const initial = settingsTabSwitch.querySelector('.tab.active');
      if (initial && initial.dataset.settingsTab) activeSettingsTab = initial.dataset.settingsTab;
      const settingsTabs = Array.from(settingsTabSwitch.querySelectorAll('.tab'));
      const switchSettingsTab = (target) => {
        activeSettingsTab = target;
        settingsTabs.forEach(tab => {
          tab.classList.toggle('active', tab.dataset.settingsTab === target);
        });
        settingsPanels.forEach(panel => {
          panel.classList.toggle('active', panel.dataset.settingsPanel === target);
        });
      };
      settingsTabs.forEach(tab => {
        tab.addEventListener('click', () => {
          switchSettingsTab(tab.dataset.settingsTab);
        });
      });
    }

    const settingsAddBtn = document.getElementById('settingsAddBtn');
    const settingsModal = document.getElementById('settingsModal');
    const settingsModalOverlay = document.getElementById('settingsModalOverlay');
    const settingsModalTitle = document.getElementById('settingsModalTitle');
    const settingsModalSub = document.getElementById('settingsModalSub');
    const settingsModalBody = document.getElementById('settingsModalBody');
    const settingsModalSave = document.getElementById('settingsModalSave');
    const settingsModalCancel = document.getElementById('settingsModalCancel');
    const settingsModalClose = document.getElementById('settingsModalClose');

    const settingsData = {
      pickup: [
        { id: 'pickup-1', label: 'å®¢å®¤', area: 'æœ¬é¤¨ 3F', sort_order: 10, is_active: true },
        { id: 'pickup-2', label: 'ãƒ­ãƒƒã‚«ãƒ¼å‰', area: '1F è¥¿', sort_order: 20, is_active: true },
        { id: 'pickup-3', label: 'å—ä»˜å‰', area: 'ãƒ­ãƒ“ãƒ¼', sort_order: 30, is_active: true },
        { id: 'pickup-4', label: 'é§è»Šå ´', area: 'å±‹å¤–', sort_order: 40, is_active: true },
        { id: 'pickup-5', label: 'ãƒˆã‚¤ãƒ¬', area: '1F æ±', sort_order: 50, is_active: false }
      ],
      storage: [
        { id: 'storage-1', name: 'ãƒ•ãƒ­ãƒ³ãƒˆæ£šB-2', area_type: 'ãƒ•ãƒ­ãƒ³ãƒˆæ£š', code_prefix: 'FRB', default_retention_days: 30, sort_order: 10, is_active: true },
        { id: 'storage-2', name: 'å€‰åº«A-3', area_type: 'å€‰åº«', code_prefix: 'WHA', default_retention_days: 60, sort_order: 20, is_active: true },
        { id: 'storage-3', name: 'ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰å†·è”µ', area_type: 'ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰', code_prefix: 'BYD', default_retention_days: null, sort_order: 30, is_active: true },
        { id: 'storage-4', name: 'è‡¨æ™‚ä¿ç®¡', area_type: 'ãã®ä»–', code_prefix: 'TMP', default_retention_days: 7, sort_order: 40, is_active: false }
      ],
      category: [
        { id: 'category-1', base_category: 'è²¡å¸ƒ', label: 'è²¡å¸ƒãƒ»ã‚«ãƒ¼ãƒ‰é¡', icon_emoji: 'ğŸ‘›', sort_order: 10, is_active: true },
        { id: 'category-2', base_category: 'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³', label: 'ã‚¹ãƒãƒ›/ç«¯æœ«', icon_emoji: 'ğŸ“±', sort_order: 20, is_active: true },
        { id: 'category-3', base_category: 'éµ', label: 'éµãƒ»ã‚«ãƒ¼ãƒ‰ã‚­ãƒ¼', icon_emoji: 'ğŸ”‘', sort_order: 30, is_active: true },
        { id: 'category-4', base_category: 'è¡£é¡', label: 'è¡£é¡/ã‚¿ã‚ªãƒ«', icon_emoji: 'ğŸ§¥', sort_order: 40, is_active: false }
      ]
    };

    const settingsIdCounters = {
      pickup: settingsData.pickup.length,
      storage: settingsData.storage.length,
      category: settingsData.category.length
    };

    const settingsSelection = { pickup: null, storage: null, category: null };
    const areaTypeOptions = ['å€‰åº«', 'ãƒ•ãƒ­ãƒ³ãƒˆæ£š', 'ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰', 'ãã®ä»–'];
    const baseCategoryOptions = ['è²¡å¸ƒ', 'ã‚«ãƒãƒ³', 'ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³', 'å……é›»å™¨', 'éµ', 'è¡£é¡', 'ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³å°ç‰©', 'ãƒ¡ã‚¬ãƒ', 'åŒ–ç²§å“', 'é´', 'å‚˜', 'ãã®ä»–'];
    const settingsTableBodies = {
      pickup: document.getElementById('settingsPickupBody'),
      storage: document.getElementById('settingsStorageBody'),
      category: document.getElementById('settingsCategoryBody')
    };
    let settingsModalState = { tab: 'pickup', mode: 'add', itemId: null };

    function escapeHtml(value) {
      return String(value)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;');
    }

    function nextSettingsId(tab) {
      settingsIdCounters[tab] += 1;
      return `${tab}-${settingsIdCounters[tab]}`;
    }

    function normalizeSortOrder(value) {
      if (value === null || value === undefined || value === '') return 9999;
      const num = Number(value);
      return Number.isFinite(num) ? num : 9999;
    }

    function nextSortOrder(list) {
      const values = list
        .map(item => item.sort_order)
        .filter(value => value !== null && value !== undefined && value !== '' && Number.isFinite(Number(value)))
        .map(value => Number(value));
      const max = values.length ? Math.max(...values) : 0;
      return max + 10;
    }

    function statusPill(active) {
      return active ? '<span class="status-pill">æœ‰åŠ¹</span>' : '<span class="status-pill inactive">åœæ­¢</span>';
    }

    function sortCell(item) {
      return item.sort_order !== null && item.sort_order !== undefined ? item.sort_order : '-';
    }

    function renderPickupTable() {
      const body = settingsTableBodies.pickup;
      if (!body) return;
      const list = [...settingsData.pickup].sort((a, b) => normalizeSortOrder(a.sort_order) - normalizeSortOrder(b.sort_order));
      body.innerHTML = '';
      if (!list.length) {
        body.innerHTML = '<tr><td class="settings-empty" colspan="5">æ‹¾å¾—å ´æ‰€ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>';
        return;
      }
      list.forEach((item, idx) => {
        const isFirst = idx === 0;
        const isLast = idx === list.length - 1;
        const tr = document.createElement('tr');
        tr.dataset.id = item.id;
        if (settingsSelection.pickup === item.id) tr.classList.add('selected-row');
        tr.innerHTML = `
          <td>${escapeHtml(item.label)}</td>
          <td>${item.area ? escapeHtml(item.area) : '-'}</td>
          <td>${sortCell(item)}</td>
          <td>${statusPill(item.is_active)}</td>
          <td>
            <div class="settings-actions">
              <button class="btn-compact btn-neutral" data-action="up" data-tab="pickup" data-id="${item.id}" ${isFirst ? 'disabled' : ''}>ä¸Šã¸</button>
              <button class="btn-compact btn-neutral" data-action="down" data-tab="pickup" data-id="${item.id}" ${isLast ? 'disabled' : ''}>ä¸‹ã¸</button>
              <button class="btn-outline btn-compact" data-action="edit" data-tab="pickup" data-id="${item.id}">ç·¨é›†</button>
              <button class="btn-compact ${item.is_active ? 'btn-danger' : 'btn-success'}" data-action="toggle" data-tab="pickup" data-id="${item.id}">${item.is_active ? 'åœæ­¢' : 'æœ‰åŠ¹åŒ–'}</button>
            </div>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    function renderStorageTable() {
      const body = settingsTableBodies.storage;
      if (!body) return;
      const list = [...settingsData.storage].sort((a, b) => normalizeSortOrder(a.sort_order) - normalizeSortOrder(b.sort_order));
      body.innerHTML = '';
      if (!list.length) {
        body.innerHTML = '<tr><td class="settings-empty" colspan="7">ä¿ç®¡å ´æ‰€ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>';
        return;
      }
      list.forEach((item, idx) => {
        const isFirst = idx === 0;
        const isLast = idx === list.length - 1;
        const retention = item.default_retention_days === null || item.default_retention_days === undefined || item.default_retention_days === '' ? 'æœªè¨­å®š' : item.default_retention_days;
        const tr = document.createElement('tr');
        tr.dataset.id = item.id;
        if (settingsSelection.storage === item.id) tr.classList.add('selected-row');
        tr.innerHTML = `
          <td>${escapeHtml(item.name)}</td>
          <td>${escapeHtml(item.area_type)}</td>
          <td>${escapeHtml(item.code_prefix)}</td>
          <td>${retention}</td>
          <td>${sortCell(item)}</td>
          <td>${statusPill(item.is_active)}</td>
          <td>
            <div class="settings-actions">
              <button class="btn-compact btn-neutral" data-action="up" data-tab="storage" data-id="${item.id}" ${isFirst ? 'disabled' : ''}>ä¸Šã¸</button>
              <button class="btn-compact btn-neutral" data-action="down" data-tab="storage" data-id="${item.id}" ${isLast ? 'disabled' : ''}>ä¸‹ã¸</button>
              <button class="btn-outline btn-compact" data-action="edit" data-tab="storage" data-id="${item.id}">ç·¨é›†</button>
              <button class="btn-compact ${item.is_active ? 'btn-danger' : 'btn-success'}" data-action="toggle" data-tab="storage" data-id="${item.id}">${item.is_active ? 'åœæ­¢' : 'æœ‰åŠ¹åŒ–'}</button>
            </div>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    function renderCategoryTable() {
      const body = settingsTableBodies.category;
      if (!body) return;
      const list = [...settingsData.category].sort((a, b) => normalizeSortOrder(a.sort_order) - normalizeSortOrder(b.sort_order));
      body.innerHTML = '';
      if (!list.length) {
        body.innerHTML = '<tr><td class="settings-empty" colspan="6">ã‚«ãƒ†ã‚´ãƒªãŒã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</td></tr>';
        return;
      }
      list.forEach((item, idx) => {
        const isFirst = idx === 0;
        const isLast = idx === list.length - 1;
        const tr = document.createElement('tr');
        tr.dataset.id = item.id;
        if (settingsSelection.category === item.id) tr.classList.add('selected-row');
        tr.innerHTML = `
          <td>${escapeHtml(item.base_category)}</td>
          <td>${item.label ? escapeHtml(item.label) : '-'}</td>
          <td>${item.icon_emoji ? escapeHtml(item.icon_emoji) : '-'}</td>
          <td>${sortCell(item)}</td>
          <td>${statusPill(item.is_active)}</td>
          <td>
            <div class="settings-actions">
              <button class="btn-compact btn-neutral" data-action="up" data-tab="category" data-id="${item.id}" ${isFirst ? 'disabled' : ''}>ä¸Šã¸</button>
              <button class="btn-compact btn-neutral" data-action="down" data-tab="category" data-id="${item.id}" ${isLast ? 'disabled' : ''}>ä¸‹ã¸</button>
              <button class="btn-outline btn-compact" data-action="edit" data-tab="category" data-id="${item.id}">ç·¨é›†</button>
              <button class="btn-compact ${item.is_active ? 'btn-danger' : 'btn-success'}" data-action="toggle" data-tab="category" data-id="${item.id}">${item.is_active ? 'åœæ­¢' : 'æœ‰åŠ¹åŒ–'}</button>
            </div>
          </td>
        `;
        body.appendChild(tr);
      });
    }

    function renderSettingsTables() {
      renderPickupTable();
      renderStorageTable();
      renderCategoryTable();
    }

    function ensureSortOrders(tab) {
      const list = settingsData[tab];
      const seen = new Set();
      let hasDuplicate = false;
      const hasInvalid = list.some(item => {
        if (item.sort_order === null || item.sort_order === undefined || item.sort_order === '') return true;
        const num = Number(item.sort_order);
        if (!Number.isFinite(num)) return true;
        if (seen.has(num)) hasDuplicate = true;
        seen.add(num);
        return false;
      });
      if (hasDuplicate || hasInvalid) {
        const sorted = [...list].sort((a, b) => normalizeSortOrder(a.sort_order) - normalizeSortOrder(b.sort_order));
        sorted.forEach((item, idx) => {
          item.sort_order = (idx + 1) * 10;
        });
        return;
      }
    }

    function moveSettingsItem(tab, direction, id) {
      ensureSortOrders(tab);
      const sorted = [...settingsData[tab]].sort((a, b) => normalizeSortOrder(a.sort_order) - normalizeSortOrder(b.sort_order));
      const index = sorted.findIndex(item => item.id === id);
      if (index < 0) return;
      const targetIndex = direction === 'up' ? index - 1 : index + 1;
      if (targetIndex < 0 || targetIndex >= sorted.length) return;
      const current = sorted[index];
      const target = sorted[targetIndex];
      const temp = current.sort_order;
      current.sort_order = target.sort_order;
      target.sort_order = temp;
      renderSettingsTables();
      showToast('é †ç•ªã‚’å¤‰æ›´ã—ã¾ã—ãŸ');
    }

    function openSettingsModal(tab, mode, itemId = null) {
      if (!settingsModal || !settingsModalOverlay) return;
      const labels = { pickup: 'æ‹¾å¾—å ´æ‰€', storage: 'ä¿ç®¡å ´æ‰€', category: 'ã‚«ãƒ†ã‚´ãƒª' };
      const subText = {
        pickup: 'labelã¯å¿…é ˆã€‚areaã¯ä»»æ„ã§ã™ã€‚',
        storage: 'name ã¨ code_prefix ã¯å¿…é ˆã€‚æœŸé™ã¯æœªè¨­å®šãªã‚‰Facilityã¸ã€‚',
        category: 'base_categoryã¯å›ºå®šã€‚è¡¨ç¤ºåã¨ä¸¦ã³é †ã‚’èª¿æ•´ã§ãã¾ã™ã€‚'
      };
      const isEdit = mode === 'edit';
      const item = isEdit ? settingsData[tab].find(entry => entry.id === itemId) : null;
      if (isEdit && !item) {
        showToast('ç·¨é›†å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
        return;
      }
      settingsModalState = { tab, mode, itemId: item ? item.id : null };
      settingsModalTitle.textContent = `${labels[tab]}ã‚’${isEdit ? 'ç·¨é›†' : 'è¿½åŠ '}`;
      settingsModalSub.textContent = subText[tab];
      settingsModalBody.innerHTML = renderSettingsForm(tab, item, mode);
      settingsModal.classList.add('open');
      settingsModalOverlay.classList.add('show');
      document.body.classList.add('modal-open');
      const firstInput = settingsModalBody.querySelector('input, select, textarea');
      if (firstInput) firstInput.focus();
    }

    function closeSettingsModal() {
      if (!settingsModal || !settingsModalOverlay) return;
      settingsModal.classList.remove('open');
      settingsModalOverlay.classList.remove('show');
      if (!detailPanel.classList.contains('open')) {
        document.body.classList.remove('modal-open');
      }
    }

    function buildOptions(options, selected, includeEmpty = false) {
      const emptyOption = includeEmpty ? '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>' : '';
      return emptyOption + options.map(option => {
        const isSelected = option === selected ? 'selected' : '';
        return `<option value="${escapeHtml(option)}" ${isSelected}>${escapeHtml(option)}</option>`;
      }).join('');
    }

    function renderSettingsForm(tab, item, mode) {
      const isEdit = mode === 'edit';
      if (tab === 'pickup') {
        const sortValue = item ? (item.sort_order !== null && item.sort_order !== undefined ? item.sort_order : '') : nextSortOrder(settingsData.pickup);
        const active = item ? item.is_active : true;
        const labelValue = item && item.label ? item.label : '';
        const areaValue = item && item.area ? item.area : '';
        return `
          <div class="settings-section">
            <div class="settings-section-title">åŸºæœ¬æƒ…å ±</div>
            <div class="settings-section-sub">æ–½è¨­ã®èª°ãŒè¦‹ã¦ã‚‚è¿·ã‚ãªã„å‘¼ã³æ–¹ã«çµ±ä¸€ã—ã¾ã™ã€‚</div>
            <div class="settings-form-grid">
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">label</div>
                  <span class="settings-required">å¿…é ˆ</span>
                </div>
                <input type="text" data-field="label" placeholder="ä¾‹ï¼šå®¢å®¤" value="${escapeHtml(labelValue)}">
                <div class="settings-helper">ä¾‹ï¼šå®¢å®¤ / ãƒ­ãƒƒã‚«ãƒ¼å‰ / å—ä»˜å‰</div>
              </div>
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">area</div>
                </div>
                <input type="text" data-field="area" placeholder="ä¾‹ï¼šæœ¬é¤¨ 3F" value="${escapeHtml(areaValue)}">
                <div class="settings-helper">ä»»æ„ã€‚ãƒ•ãƒ­ã‚¢ã‚„é¤¨å†…ã‚¨ãƒªã‚¢ã‚’æƒãˆã‚‹ã¨æ¤œç´¢ãŒå®‰å®šã€‚</div>
              </div>
            </div>
          </div>
          <div class="settings-section">
            <div class="settings-section-title">è¡¨ç¤º/æœ‰åŠ¹</div>
            <div class="settings-form-grid">
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">sort_order</div>
                </div>
                <input type="number" data-field="sort_order" value="${sortValue}">
                <div class="settings-helper">å°ã•ã„ã»ã©ä¸Šã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
              </div>
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">is_active</div>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" data-field="is_active" ${active ? 'checked' : ''}>
                  æœ‰åŠ¹
                </label>
                <div class="settings-helper">åœæ­¢ã—ã¦ã‚‚å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã¯ä¿æŒã•ã‚Œã¾ã™ã€‚</div>
              </div>
            </div>
          </div>
        `;
      }
      if (tab === 'storage') {
        const sortValue = item ? (item.sort_order !== null && item.sort_order !== undefined ? item.sort_order : '') : nextSortOrder(settingsData.storage);
        const active = item ? item.is_active : true;
        const retentionValue = item && item.default_retention_days !== null && item.default_retention_days !== undefined ? item.default_retention_days : '';
        const nameValue = item && item.name ? item.name : '';
        const areaType = item && item.area_type ? item.area_type : areaTypeOptions[0];
        const codePrefixValue = item && item.code_prefix ? item.code_prefix : '';
        return `
          <div class="settings-section">
            <div class="settings-section-title">åŸºæœ¬æƒ…å ±</div>
            <div class="settings-section-sub">ä¿ç®¡å ´æ‰€ã®å‘¼ã³æ–¹ã¨åŒºåˆ†ã‚’æƒãˆã¾ã™ã€‚</div>
            <div class="settings-form-grid">
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">name</div>
                  <span class="settings-required">å¿…é ˆ</span>
                </div>
                <input type="text" data-field="name" placeholder="ä¾‹ï¼šãƒ•ãƒ­ãƒ³ãƒˆæ£šB-2" value="${escapeHtml(nameValue)}">
                <div class="settings-helper">æ£šç•ªã‚„å€‰åº«åã¾ã§å«ã‚ã‚‹ã¨æ¤œç´¢ãŒæ—©ã„ã§ã™ã€‚</div>
              </div>
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">area_type</div>
                </div>
                <select data-field="area_type">${buildOptions(areaTypeOptions, areaType)}</select>
                <div class="settings-helper">é‹ç”¨ä¸Šã®å¤§åˆ†é¡ï¼ˆå€‰åº«/ãƒ•ãƒ­ãƒ³ãƒˆæ£šãªã©ï¼‰ã€‚</div>
              </div>
            </div>
          </div>
          <div class="settings-section">
            <div class="settings-section-title">æ¡ç•ª/æœŸé™</div>
            <div class="settings-section-sub">ç®¡ç†ç•ªå·ã®æ¥é ­è¾ã¨ä¿ç®¡æœŸé™ã«é€£å‹•ã—ã¾ã™ã€‚</div>
            <div class="settings-form-grid">
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">code_prefix</div>
                  <span class="settings-required">å¿…é ˆ</span>
                </div>
                <input type="text" data-field="code_prefix" placeholder="ä¾‹ï¼šFRB" value="${escapeHtml(codePrefixValue)}">
                <div class="settings-helper">è‹±å­—3æ–‡å­—ãªã©çŸ­ã„ã‚³ãƒ¼ãƒ‰ãŒé‹ç”¨ã—ã‚„ã™ã„ã§ã™ã€‚</div>
              </div>
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">default_retention_days</div>
                </div>
                <input type="number" data-field="default_retention_days" placeholder="æœªè¨­å®šãªã‚‰ç©ºæ¬„" value="${retentionValue}">
                <div class="settings-helper">æœªè¨­å®šã®å ´åˆã¯æ–½è¨­å…¨ä½“ã®è¨­å®šã‚’ä½¿ç”¨ã€‚</div>
              </div>
            </div>
          </div>
          <div class="settings-section">
            <div class="settings-section-title">è¡¨ç¤º/æœ‰åŠ¹</div>
            <div class="settings-form-grid">
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">sort_order</div>
                </div>
                <input type="number" data-field="sort_order" value="${sortValue}">
                <div class="settings-helper">å°ã•ã„ã»ã©ä¸Šã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
              </div>
              <div class="settings-field">
                <div class="settings-label-row">
                  <div class="label">is_active</div>
                </div>
                <label class="settings-toggle">
                  <input type="checkbox" data-field="is_active" ${active ? 'checked' : ''}>
                  æœ‰åŠ¹
                </label>
                <div class="settings-helper">åœæ­¢ã™ã‚‹ã¨ç™»éŒ²å€™è£œã‹ã‚‰å¤–ã‚Œã¾ã™ã€‚</div>
              </div>
            </div>
          </div>
        `;
      }
      const sortValue = item ? (item.sort_order !== null && item.sort_order !== undefined ? item.sort_order : '') : nextSortOrder(settingsData.category);
      const active = item ? item.is_active : true;
      const baseCategory = item && item.base_category ? item.base_category : '';
      const labelValue = item && item.label ? item.label : '';
      const iconValue = item && item.icon_emoji ? item.icon_emoji : '';
      const baseOptions = buildOptions(baseCategoryOptions, baseCategory, !isEdit);
      return `
        <div class="settings-section">
          <div class="settings-section-title">ãƒ™ãƒ¼ã‚¹/è¡¨ç¤ºå</div>
          <div class="settings-section-sub">ãƒ™ãƒ¼ã‚¹ã‚«ãƒ†ã‚´ãƒªã¯å›ºå®šã§ã€è¡¨ç¤ºåã ã‘æ–½è¨­åˆ¥ã«èª¿æ•´ã§ãã¾ã™ã€‚</div>
          <div class="settings-form-grid">
            <div class="settings-field">
              <div class="settings-label-row">
                <div class="label">base_category</div>
                <span class="settings-required">å¿…é ˆ</span>
              </div>
              <select data-field="base_category" ${isEdit ? 'disabled' : ''}>${baseOptions}</select>
              <div class="settings-helper">æœªé¸æŠã®ã¾ã¾ä¿å­˜ã§ãã¾ã›ã‚“ã€‚</div>
            </div>
            <div class="settings-field">
              <div class="settings-label-row">
                <div class="label">label</div>
              </div>
              <input type="text" data-field="label" placeholder="ä¾‹ï¼šè²¡å¸ƒãƒ»ã‚«ãƒ¼ãƒ‰é¡" value="${escapeHtml(labelValue)}">
              <div class="settings-helper">æœªå…¥åŠ›ã®å ´åˆã¯ãƒ™ãƒ¼ã‚¹åãŒè‡ªå‹•ã§å…¥ã‚Šã¾ã™ã€‚</div>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-section-title">ã‚¢ã‚¤ã‚³ãƒ³/ä¸¦ã³é †</div>
          <div class="settings-form-grid">
            <div class="settings-field">
              <div class="settings-label-row">
                <div class="label">icon_emoji</div>
              </div>
              <input type="text" data-field="icon_emoji" placeholder="ä¾‹ï¼šğŸ‘›" value="${escapeHtml(iconValue)}">
              <div class="settings-helper">ä»»æ„ã€‚ç¾å ´ã§è¦‹åˆ†ã‘ã‚„ã™ã„çµµæ–‡å­—ã‚’ã€‚</div>
            </div>
            <div class="settings-field">
              <div class="settings-label-row">
                <div class="label">sort_order</div>
              </div>
              <input type="number" data-field="sort_order" value="${sortValue}">
              <div class="settings-helper">å°ã•ã„ã»ã©ä¸Šã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
            </div>
          </div>
        </div>
        <div class="settings-section">
          <div class="settings-section-title">è¡¨ç¤º/æœ‰åŠ¹</div>
          <div class="settings-form-grid">
            <div class="settings-field">
              <div class="settings-label-row">
                <div class="label">is_active</div>
              </div>
              <label class="settings-toggle">
                <input type="checkbox" data-field="is_active" ${active ? 'checked' : ''}>
                æœ‰åŠ¹
              </label>
              <div class="settings-helper">åœæ­¢ã™ã‚‹ã¨ã‚«ãƒ†ã‚´ãƒªãƒœã‚¿ãƒ³ã¯éè¡¨ç¤ºã€‚</div>
            </div>
          </div>
        </div>
      `;
    }

    function readNumberField(input) {
      const raw = input.value.trim();
      if (!raw) return null;
      const num = Number(raw);
      return Number.isFinite(num) ? num : null;
    }

    function readSettingsForm(tab) {
      const getField = (name) => settingsModalBody.querySelector(`[data-field="${name}"]`);
      if (tab === 'pickup') {
        const label = getField('label').value.trim();
        if (!label) {
          showToast('label ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          getField('label').focus();
          return null;
        }
        return {
          label,
          area: getField('area').value.trim(),
          sort_order: readNumberField(getField('sort_order')),
          is_active: getField('is_active').checked
        };
      }
      if (tab === 'storage') {
        const name = getField('name').value.trim();
        const codePrefix = getField('code_prefix').value.trim();
        if (!name) {
          showToast('name ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          getField('name').focus();
          return null;
        }
        if (!codePrefix) {
          showToast('code_prefix ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          getField('code_prefix').focus();
          return null;
        }
        return {
          name,
          area_type: getField('area_type').value,
          code_prefix: codePrefix,
          default_retention_days: readNumberField(getField('default_retention_days')),
          sort_order: readNumberField(getField('sort_order')),
          is_active: getField('is_active').checked
        };
      }
      const baseCategory = getField('base_category').value.trim();
      if (!baseCategory) {
        showToast('base_category ã‚’é¸æŠã—ã¦ãã ã•ã„');
        getField('base_category').focus();
        return null;
      }
      let label = getField('label').value.trim();
      if (!label) label = baseCategory;
      return {
        base_category: baseCategory,
        label,
        icon_emoji: getField('icon_emoji').value.trim(),
        sort_order: readNumberField(getField('sort_order')),
        is_active: getField('is_active').checked
      };
    }

    function saveSettingsModal() {
      const { tab, mode, itemId } = settingsModalState;
      const values = readSettingsForm(tab);
      if (!values) return;
      if (tab === 'category' && mode === 'add') {
        const exists = settingsData.category.some(entry => entry.base_category === values.base_category);
        if (exists) {
          showToast('ã“ã®ãƒ™ãƒ¼ã‚¹ã‚«ãƒ†ã‚´ãƒªã¯æ—¢ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™');
          return;
        }
      }
      if (mode === 'add') {
        settingsData[tab].push({ id: nextSettingsId(tab), ...values });
      } else {
        const item = settingsData[tab].find(entry => entry.id === itemId);
        if (!item) {
          showToast('ç·¨é›†å¯¾è±¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
          return;
        }
        Object.assign(item, values);
      }
      closeSettingsModal();
      renderSettingsTables();
      showToast('è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    }

    function handleSettingsTableClick(tab, event) {
      const actionBtn = event.target.closest('button[data-action]');
      const row = event.target.closest('tr[data-id]');
      if (actionBtn) {
        event.preventDefault();
        event.stopPropagation();
        const action = actionBtn.dataset.action;
        const rowId = actionBtn.dataset.id;
        if (action === 'up' || action === 'down') {
          moveSettingsItem(tab, action, rowId);
          return;
        }
        if (action === 'edit') {
          openSettingsModal(tab, 'edit', rowId);
          return;
        }
        if (action === 'toggle') {
          const item = settingsData[tab].find(entry => entry.id === rowId);
          if (!item) return;
          item.is_active = !item.is_active;
          renderSettingsTables();
          showToast(item.is_active ? 'æœ‰åŠ¹ã«ã—ã¾ã—ãŸ' : 'åœæ­¢ã—ã¾ã—ãŸ');
        }
        return;
      }
      if (row) {
        settingsSelection[tab] = row.dataset.id;
        renderSettingsTables();
      }
    }

    Object.entries(settingsTableBodies).forEach(([tab, body]) => {
      if (!body) return;
      body.addEventListener('click', (event) => handleSettingsTableClick(tab, event));
    });

    if (viewSettings) {
      viewSettings.addEventListener('click', (event) => {
        const button = event.target.closest('[data-settings-action]');
        if (!button) return;
        const panel = button.closest('[data-settings-panel]');
        const tab = panel ? panel.dataset.settingsPanel : activeSettingsTab;
        if (button.dataset.settingsAction === 'add') {
          openSettingsModal(tab, 'add');
          return;
        }
        if (button.dataset.settingsAction === 'edit') {
          const selectedId = settingsSelection[tab];
          if (!selectedId) {
            showToast('ç·¨é›†ã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
            return;
          }
          openSettingsModal(tab, 'edit', selectedId);
        }
      });
    }

    if (settingsAddBtn) {
      settingsAddBtn.addEventListener('click', () => {
        openSettingsModal(activeSettingsTab, 'add');
      });
    }

    if (settingsModalOverlay) {
      settingsModalOverlay.addEventListener('click', closeSettingsModal);
    }
    if (settingsModalCancel) settingsModalCancel.addEventListener('click', closeSettingsModal);
    if (settingsModalClose) settingsModalClose.addEventListener('click', closeSettingsModal);
    if (settingsModalSave) settingsModalSave.addEventListener('click', saveSettingsModal);

    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape' && settingsModal && settingsModal.classList.contains('open')) {
        closeSettingsModal();
      }
    });

    renderSettingsTables();

    // Summary card clicks
    document.querySelectorAll('.card.clickable').forEach(card => {
      card.addEventListener('click', () => {
        const filter = card.dataset.filter;
        if (filter === 'stock') { activeStatuses = ['ä¿ç®¡ä¸­']; updateStatusPills(); }
        if (filter === 'warning') { activeStatuses = ['æœŸé™é–“è¿‘']; updateStatusPills(); }
        if (filter === 'expired') { activeStatuses = ['æœŸé™åˆ‡ã‚Œ']; updateStatusPills(); }
        filterData();
      });
    });

    // Deadline cards
    const deadlineList = document.getElementById('deadlineList');
    function renderDeadline() {
      const soon = data.filter(d => d.status === 'æœŸé™é–“è¿‘' || d.status === 'æœŸé™åˆ‡ã‚Œ').sort((a,b)=>a.daysLeft - b.daysLeft);
      deadlineList.innerHTML = '';
      soon.forEach(item => {
        const div = document.createElement('div');
        div.className = 'card';
        div.innerHTML = `
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <div style="font-weight:800;color:var(--heading);">${item.id}ãƒ»${item.category}</div>
            <span class="${badgeClass(item.status)}">${item.status}</span>
          </div>
          <div style="display:flex; gap:10px; align-items:center;">
            <img class="thumb" src="${resolveImage(item)}" alt="">
            <div style="color:var(--muted); font-size:13px;">
              <div>ä¿ç®¡æœŸé™: <strong style="color:var(--heading);">${item.deadline}</strong> (${daysLabel(item.daysLeft)})</div>
              <div>å ´æ‰€: ${item.place}</div>
            </div>
          </div>
          <div class="actions">
            <button class="btn-outline" style="padding:10px 12px;">å»ƒæ£„æ¸ˆã«ã™ã‚‹</button>
            <button class="btn-ghost">è­¦å¯Ÿå¼•æ¸¡ã—</button>
          </div>
        `;
        deadlineList.appendChild(div);
      });
    }

    // Match view
    const matchGrid = document.getElementById('matchGrid');
    const matchMetaText = document.getElementById('matchMetaText');
    const matchCount = document.getElementById('matchCount');
    const matchPhoto = document.getElementById('matchPhoto');
    const matchId = document.getElementById('matchId');
    const matchCategoryLabel = document.getElementById('matchCategoryLabel');
    const matchStatus = document.getElementById('matchStatus');
    const matchFound = document.getElementById('matchFound');
    const matchStay = document.getElementById('matchStay');
    const matchRoomDetail = document.getElementById('matchRoomDetail');
    const matchPlace = document.getElementById('matchPlace');
    const matchFeature = document.getElementById('matchFeature');
    const matchStorage = document.getElementById('matchStorage');
    const matchConfirm = document.getElementById('matchConfirm');
    const matchExclude = document.getElementById('matchExclude');
    const roomPills = document.getElementById('roomPills');

    const matchFilters = {
      keyword: '',
      category: 'all',
      room: '',
      stayFrom: '',
      stayTo: ''
    };

    function renderRoomPills() {
      const rooms = [...new Set(data.map(d => d.room).filter(r => r && r !== '-'))].slice(0, 8);
      roomPills.innerHTML = rooms.map(r => `<div class="pill ${matchFilters.room===r?'active':''}" data-room="${r}" style="padding:6px 10px; border-radius:10px; font-size:12px;">${r}</div>`).join('');
      roomPills.querySelectorAll('.pill').forEach(p => {
        p.addEventListener('click', () => {
          matchFilters.room = matchFilters.room === p.dataset.room ? '' : p.dataset.room;
          document.getElementById('matchRoom').value = matchFilters.room;
          renderRoomPills();
          renderMatchGrid();
        });
      });
    }

    function applyMatchFilters() {
      let list = [...data];
      const k = matchFilters.keyword.toLowerCase();
      if (k) {
        list = list.filter(d => Object.values(d).join(' ').toLowerCase().includes(k));
      }
      if (matchFilters.category !== 'all') list = list.filter(d => d.category === matchFilters.category);
      if (matchFilters.room) list = list.filter(d => (d.room || '').includes(matchFilters.room));
      if (matchFilters.stayFrom) list = list.filter(d => d.stay >= matchFilters.stayFrom);
      if (matchFilters.stayTo) list = list.filter(d => d.stay <= matchFilters.stayTo);
      return list;
    }

    function renderMatchGrid() {
      const list = applyMatchFilters();
      matchGrid.innerHTML = '';
      matchMetaText.textContent = `${list.length}ä»¶è¡¨ç¤º`;
      matchCount.textContent = `${list.length}ä»¶`;
      if (!list.length) {
        matchGrid.innerHTML = '<div style="color:var(--muted);">è©²å½“ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'match-card';
        card.innerHTML = `
          <img src="${resolveImage(item)}" alt="">
          <div class="body">
            <div class="title" style="font-weight:700;">${item.id}ãƒ»${item.category}</div>
            <div class="tags">
              <div class="tag">${item.category}</div>
              <div class="tag">${item.color}</div>
            </div>
            <div class="sub">${item.date} / ${item.place}</div>
          </div>
        `;
        card.addEventListener('click', () => selectMatch(item));
        if (matchSelected && matchSelected.id === item.id) {
          card.classList.add('selected');
          const badge = document.createElement('div');
          badge.className = 'tag selected-badge';
          badge.textContent = 'é¸æŠä¸­';
          card.querySelector('.tags').appendChild(badge);
          card.style.borderWidth = '2px';
        }
        matchGrid.appendChild(card);
      });
      if (!matchSelected && list.length) selectMatch(list[0]);
    }

    function selectMatch(item) {
      matchSelected = item;
      matchPhoto.src = resolveImage(item);
      matchId.textContent = item.id;
      matchCategoryLabel.textContent = item.category;
      matchStatus.textContent = item.status;
      matchFound.textContent = item.date;
      matchStay.textContent = item.stay || 'â€•';
      matchRoomDetail.textContent = item.room || 'â€•';
      matchPlace.textContent = item.place;
      matchFeature.textContent = item.feature;
      matchStorage.textContent = item.storage;
      renderMatchGrid();
    }

    ['matchKeyword','matchRoom','matchStayFrom','matchStayTo'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', () => {
        if (id === 'matchKeyword') matchFilters.keyword = el.value;
        if (id === 'matchRoom') matchFilters.room = el.value;
        if (id === 'matchStayFrom') matchFilters.stayFrom = el.value;
        if (id === 'matchStayTo') matchFilters.stayTo = el.value;
        renderMatchGrid();
      });
    });
    document.getElementById('matchCategory').addEventListener('change', e => {
      matchFilters.category = e.target.value;
      renderMatchGrid();
    });
    matchConfirm.addEventListener('click', () => {
      if (matchSelected) showToast(`${matchSelected.id} ã‚’ãŠå®¢æ§˜ã®è½ã¨ã—ç‰©ã¨ã—ã¦ç¢ºå®š`);
    });
    matchExclude.addEventListener('click', () => {
      if (matchSelected) showToast(`${matchSelected.id} ã‚’å€™è£œã‹ã‚‰å¤–ã—ã¾ã—ãŸ`);
    });

    // Contact case (å•ã„åˆã‚ã›å¯¾å¿œ)
    const contactList = document.getElementById('contactList');
    const contactDetail = document.getElementById('contactDetail');
    const contactMetaText = document.getElementById('contactMetaText');
    const contactSearch = document.getElementById('contactSearch');
    const contactStatusPills = Array.from(document.querySelectorAll('#contactStatusFilters .pill'));
    const contactNewBtn = document.getElementById('contactNewBtn');

    let contactFilterStatus = 'all';
    let contactSearchQuery = '';
    let currentCaseId = null;

    const caseStatusClass = (status) => {
      if (status === 'å¯¾å¿œä¸­') return 'case-status in-progress';
      if (status === 'ä¸€è‡´ãƒ»è¿”å´äºˆå®š') return 'case-status match';
      if (status === 'è¦‹ã¤ã‹ã‚‰ãš') return 'case-status miss';
      return 'case-status close';
    };

    function getCaseById(id) {
      return contactCases.find(item => item.id === id);
    }

    function truncateText(text, limit = 60) {
      if (!text) return '';
      const trimmed = text.trim();
      if (trimmed.length <= limit) return trimmed;
      return `${trimmed.slice(0, limit)}â€¦`;
    }

    function matchesContactSearch(item, query) {
      if (!query) return true;
      const joined = [
        item.id,
        item.account,
        item.status,
        item.channel,
        item.feature_text,
        item.stay_date,
        item.room_number,
        item.contact_phone,
        item.contact_email,
        item.matched_lost_item_id
      ].filter(Boolean).join(' ').toLowerCase();
      return joined.includes(query);
    }

    function filteredContactCases() {
      return contactCases.filter(item => {
        if (contactFilterStatus !== 'all' && item.status !== contactFilterStatus) return false;
        return matchesContactSearch(item, contactSearchQuery);
      });
    }

    function nextContactCaseId() {
      const numbers = contactCases
        .map(item => Number(String(item.id).replace('CC-', '')))
        .filter(num => Number.isFinite(num));
      const next = numbers.length ? Math.max(...numbers) + 1 : 101;
      return `CC-${String(next).padStart(3, '0')}`;
    }

    function renderContactList() {
      if (!contactList || !contactMetaText) return;
      const list = filteredContactCases();
      contactMetaText.textContent = `å…¨ ${contactCases.length}ä»¶ / è¡¨ç¤º ${list.length}ä»¶`;
      contactList.innerHTML = '';
      if (!list.length) {
        contactList.innerHTML = '<div class="contact-empty">è©²å½“ã™ã‚‹å•ã„åˆã‚ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</div>';
        return;
      }
      list.forEach(item => {
        const card = document.createElement('div');
        card.className = 'contact-card';
        if (currentCaseId === item.id) card.classList.add('active');
        const matchedItem = item.matched_lost_item_id ? data.find(d => d.id === item.matched_lost_item_id) : null;
        const matchedLabel = matchedItem ? `${matchedItem.id}ãƒ»${matchedItem.category}` : 'æœªä¸€è‡´';
        card.innerHTML = `
          <div class="contact-card-head">
            <div class="contact-card-title">${item.id} ${item.account ? `ãƒ»${item.account}æ§˜` : ''}</div>
            <span class="${caseStatusClass(item.status)}">${item.status}</span>
          </div>
          <div class="contact-meta-row">
            <span class="contact-chip">${item.channel}</span>
            <span class="contact-chip">${item.contact_phone || item.contact_email || 'é€£çµ¡å…ˆæœªå…¥åŠ›'}</span>
            <span class="contact-chip">ä¸€è‡´: ${matchedLabel}</span>
          </div>
          <div class="contact-snippet">${truncateText(item.feature_text, 70)}</div>
          <div class="contact-meta-row">
            <span>æœ€çµ‚æ›´æ–°: ${item.updated_at}</span>
          </div>
        `;
        card.addEventListener('click', () => {
          currentCaseId = item.id;
          renderContactList();
          renderContactDetail();
        });
        contactList.appendChild(card);
      });
    }

    function renderContactDetail() {
      if (!contactDetail) return;
      if (!currentCaseId && contactCases.length) {
        currentCaseId = contactCases[0].id;
      }
      const item = currentCaseId ? getCaseById(currentCaseId) : null;
      if (!item) {
        contactDetail.innerHTML = '<div class="contact-empty">å•ã„åˆã‚ã›ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</div>';
        return;
      }
      const matchedItem = item.matched_lost_item_id ? data.find(d => d.id === item.matched_lost_item_id) : null;
      const matchedPhotoNote = matchedItem && !hasImage(matchedItem) ? 'å†™çœŸæœªç™»éŒ²' : 'å†™çœŸç™»éŒ²æ¸ˆã¿';
      contactDetail.innerHTML = `
        <div class="contact-detail-head">
          <div>
            <div class="contact-detail-id">${item.id}</div>
            <div class="contact-detail-sub">æœ€çµ‚æ›´æ–°: ${item.updated_at} / ä½œæˆ: ${item.created_at}</div>
          </div>
          <div class="actions">
            <button class="btn-outline" id="contactSaveBtn">ä¿å­˜</button>
          </div>
        </div>

        <div class="contact-section">
          <div class="contact-section-title">å•ã„åˆã‚ã›æƒ…å ±</div>
          <div class="contact-grid">
            <div class="field">
              <div class="label">æ–½è¨­</div>
              <input id="caseFacility" type="text" value="${item.facility || ''}">
            </div>
            <div class="field">
              <div class="label">é¡§å®¢åï¼ˆä»»æ„ï¼‰</div>
              <input id="caseAccount" type="text" value="${item.account || ''}" placeholder="ä¾‹ï¼‰å±±ç”°">
            </div>
            <div class="field">
              <div class="label">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</div>
              <select id="caseStatus">
                ${['å¯¾å¿œä¸­','ä¸€è‡´ãƒ»è¿”å´äºˆå®š','è¦‹ã¤ã‹ã‚‰ãš','ã‚¯ãƒ­ãƒ¼ã‚º'].map(s => `<option ${item.status===s?'selected':''}>${s}</option>`).join('')}
              </select>
            </div>
            <div class="field">
              <div class="label">ãƒãƒ£ãƒãƒ«</div>
              <select id="caseChannel">
                ${['é›»è©±','LINE','ãƒ¡ãƒ¼ãƒ«','ãã®ä»–'].map(c => `<option ${item.channel===c?'selected':''}>${c}</option>`).join('')}
              </select>
            </div>
          </div>
          <div class="field">
            <div class="label">èãå–ã‚Šãƒ¡ãƒ¢</div>
            <textarea id="caseFeatureText" class="contact-textarea" placeholder="ç‰¹å¾´ãƒ»è‰²ãƒ»ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ»æ‹¾å¾—å ´æ‰€ãªã©">${item.feature_text || ''}</textarea>
          </div>
          <div class="contact-grid">
            <div class="field">
              <div class="label">å®¿æ³Šæ—¥ï¼ˆä»»æ„ï¼‰</div>
              <input id="caseStayDate" type="date" value="${item.stay_date || ''}">
            </div>
            <div class="field">
              <div class="label">éƒ¨å±‹ç•ªå·ï¼ˆä»»æ„ï¼‰</div>
              <input id="caseRoomNumber" type="text" value="${item.room_number || ''}">
            </div>
          </div>
          <div class="contact-grid">
            <div class="field">
              <div class="label">é›»è©±</div>
              <input id="casePhone" type="tel" value="${item.contact_phone || ''}" placeholder="090-xxxx-xxxx">
            </div>
            <div class="field">
              <div class="label">ãƒ¡ãƒ¼ãƒ«</div>
              <input id="caseEmail" type="email" value="${item.contact_email || ''}" placeholder="example@example.com">
            </div>
          </div>
        </div>

        <div class="contact-section">
          <div class="contact-section-title">ä¸€è‡´ã—ãŸè½ã¨ã—ç‰©</div>
          ${matchedItem ? `
            <div class="contact-match-card">
              <div class="contact-match-head">
                <div>
                  <div class="contact-match-title">${matchedItem.id}ãƒ»${matchedItem.category}</div>
                  <div class="contact-match-meta">
                    <span>æ‹¾å¾—: ${matchedItem.place}</span>
                    <span>ä¿ç®¡: ${matchedItem.storage}</span>
                    <span>${matchedPhotoNote}</span>
                  </div>
                </div>
                <div class="actions">
                  <button class="btn-outline btn-compact" id="openMatchedItem">è©³ç´°ã‚’é–‹ã</button>
                  <button class="btn-ghost btn-compact" id="unlinkMatchedItem">è§£é™¤</button>
                </div>
              </div>
              <div class="contact-match-body">
                <img src="${resolveImage(matchedItem)}" alt="">
                <div class="contact-meta-row">
                  <span class="contact-chip">${matchedItem.status}</span>
                  <span class="contact-chip">æœŸé™: ${matchedItem.deadline}</span>
                  <span class="contact-chip">${daysLabel(matchedItem.daysLeft)}</span>
                </div>
              </div>
            </div>
          ` : `
            <div class="contact-empty">ã¾ã ä¸€è‡´ã—ãŸè½ã¨ã—ç‰©ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>
          `}
          <div class="field">
            <div class="label">å€™è£œæ¤œç´¢</div>
            <div class="input">
              <span class="icon">ğŸ”</span>
              <input id="caseMatchSearch" type="text" placeholder="IDãƒ»ã‚«ãƒ†ã‚´ãƒªãƒ»ç‰¹å¾´ãƒ»æ‹¾å¾—å ´æ‰€ã§æ¤œç´¢">
            </div>
          </div>
          <div class="contact-candidate-list" id="caseMatchList"></div>
        </div>

        <div class="contact-section">
          <div class="contact-section-title">ç™ºé€æƒ…å ±</div>
          <div class="contact-grid">
            <div class="field">
              <div class="label">è¿½è·¡ç•ªå·</div>
              <input id="caseTracking" type="text" value="${item.shipping.tracking_number || ''}">
            </div>
            <div class="field">
              <div class="label">ç™ºé€æ—¥</div>
              <input id="caseShippedAt" type="date" value="${item.shipping.shipped_at || ''}">
            </div>
          </div>
          <div class="field">
            <div class="label">ç™ºé€ãƒ¡ãƒ¢</div>
            <textarea id="caseShippingNote" class="contact-textarea" placeholder="ç™ºé€æ–¹æ³•ã‚„ä½æ‰€ç¢ºèªçŠ¶æ³">${item.shipping.shipping_note || ''}</textarea>
          </div>
        </div>
      `;

      const touchCase = () => {
        item.updated_at = formatTimestamp();
      };

      const updateListOnly = () => {
        touchCase();
        const header = contactDetail.querySelector('.contact-detail-sub');
        if (header) header.textContent = `æœ€çµ‚æ›´æ–°: ${item.updated_at} / ä½œæˆ: ${item.created_at}`;
        renderContactList();
      };

      const caseStatus = document.getElementById('caseStatus');
      if (caseStatus) caseStatus.addEventListener('change', (e) => {
        item.status = e.target.value;
        updateListOnly();
      });
      const caseChannel = document.getElementById('caseChannel');
      if (caseChannel) caseChannel.addEventListener('change', (e) => {
        item.channel = e.target.value;
        updateListOnly();
      });
      const caseFacility = document.getElementById('caseFacility');
      if (caseFacility) caseFacility.addEventListener('input', (e) => {
        item.facility = e.target.value;
        updateListOnly();
      });
      const caseAccount = document.getElementById('caseAccount');
      if (caseAccount) caseAccount.addEventListener('input', (e) => {
        item.account = e.target.value;
        updateListOnly();
      });
      const caseFeatureText = document.getElementById('caseFeatureText');
      if (caseFeatureText) caseFeatureText.addEventListener('input', (e) => {
        item.feature_text = e.target.value;
        updateListOnly();
      });
      const caseStayDate = document.getElementById('caseStayDate');
      if (caseStayDate) caseStayDate.addEventListener('input', (e) => {
        item.stay_date = e.target.value;
        updateListOnly();
      });
      const caseRoomNumber = document.getElementById('caseRoomNumber');
      if (caseRoomNumber) caseRoomNumber.addEventListener('input', (e) => {
        item.room_number = e.target.value;
        updateListOnly();
      });
      const casePhone = document.getElementById('casePhone');
      if (casePhone) casePhone.addEventListener('input', (e) => {
        item.contact_phone = e.target.value;
        updateListOnly();
      });
      const caseEmail = document.getElementById('caseEmail');
      if (caseEmail) caseEmail.addEventListener('input', (e) => {
        item.contact_email = e.target.value;
        updateListOnly();
      });
      const caseTracking = document.getElementById('caseTracking');
      if (caseTracking) caseTracking.addEventListener('input', (e) => {
        item.shipping.tracking_number = e.target.value;
        updateListOnly();
      });
      const caseShippedAt = document.getElementById('caseShippedAt');
      if (caseShippedAt) caseShippedAt.addEventListener('input', (e) => {
        item.shipping.shipped_at = e.target.value;
        updateListOnly();
      });
      const caseShippingNote = document.getElementById('caseShippingNote');
      if (caseShippingNote) caseShippingNote.addEventListener('input', (e) => {
        item.shipping.shipping_note = e.target.value;
        updateListOnly();
      });

      const unlinkBtn = document.getElementById('unlinkMatchedItem');
      if (unlinkBtn) {
        unlinkBtn.addEventListener('click', () => {
          item.matched_lost_item_id = '';
          updateListOnly();
          renderContactDetail();
          showToast('ä¸€è‡´æƒ…å ±ã‚’è§£é™¤ã—ã¾ã—ãŸ');
        });
      }

      const openMatchedItem = document.getElementById('openMatchedItem');
      if (openMatchedItem && matchedItem) {
        openMatchedItem.addEventListener('click', () => {
          openDetail(matchedItem);
        });
      }

      const saveBtn = document.getElementById('contactSaveBtn');
      if (saveBtn) {
        saveBtn.addEventListener('click', () => {
          if (!item.contact_phone && !item.contact_email) {
            showToast('é›»è©±ã¾ãŸã¯ãƒ¡ãƒ¼ãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
            return;
          }
          touchCase();
          renderContactList();
          showToast('å•ã„åˆã‚ã›å†…å®¹ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
        });
      }

      const matchSearch = document.getElementById('caseMatchSearch');
      const matchList = document.getElementById('caseMatchList');
      const renderMatchCandidates = () => {
        if (!matchList) return;
        const q = (matchSearch ? matchSearch.value : '').trim().toLowerCase();
        const candidates = data.filter(entry => {
          if (!q) return true;
          const joined = [entry.id, entry.category, entry.place, entry.feature, entry.brand, entry.color, entry.room].filter(Boolean).join(' ').toLowerCase();
          return joined.includes(q);
        }).slice(0, 6);
        matchList.innerHTML = '';
        if (!candidates.length) {
          matchList.innerHTML = '<div class="contact-empty">å€™è£œãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚</div>';
          return;
        }
        candidates.forEach(candidate => {
          const row = document.createElement('div');
          const selected = item.matched_lost_item_id === candidate.id;
          row.className = 'contact-candidate';
          row.innerHTML = `
            <img src="${resolveImage(candidate)}" alt="">
            <div>
              <div class="title">${candidate.id}ãƒ»${candidate.category}</div>
              <div class="sub">${candidate.place} / ${candidate.storage}</div>
              <div class="sub">${candidate.status}ãƒ»${candidate.deadline}</div>
            </div>
            <div>
              <button class="btn-outline btn-compact" data-match-id="${candidate.id}" ${selected ? 'disabled' : ''}>
                ${selected ? 'ç´ä»˜ã‘æ¸ˆã¿' : 'ç´ä»˜ã‘'}
              </button>
            </div>
          `;
          matchList.appendChild(row);
        });
        matchList.querySelectorAll('[data-match-id]').forEach(btn => {
          btn.addEventListener('click', () => {
            const id = btn.dataset.matchId;
            item.matched_lost_item_id = id;
            if (item.status === 'å¯¾å¿œä¸­') item.status = 'ä¸€è‡´ãƒ»è¿”å´äºˆå®š';
            touchCase();
            renderContactList();
            renderContactDetail();
            showToast('ä¸€è‡´ã—ãŸè½ã¨ã—ç‰©ã‚’ç´ä»˜ã‘ã¾ã—ãŸ');
          });
        });
      };
      if (matchSearch) matchSearch.addEventListener('input', renderMatchCandidates);
      renderMatchCandidates();
    }

    if (contactSearch) {
      contactSearch.addEventListener('input', (e) => {
        contactSearchQuery = e.target.value.trim().toLowerCase();
        renderContactList();
      });
    }

    contactStatusPills.forEach(pill => {
      pill.addEventListener('click', () => {
        contactFilterStatus = pill.dataset.status;
        contactStatusPills.forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        renderContactList();
      });
    });

    if (contactNewBtn) {
      contactNewBtn.addEventListener('click', () => {
        const newId = nextContactCaseId();
        const timestamp = formatTimestamp();
        const freshCase = {
          id: newId,
          facility: 'èŠ±æœˆæ—…é¤¨ãƒ»æœ¬é¤¨',
          account: '',
          status: 'å¯¾å¿œä¸­',
          channel: 'é›»è©±',
          feature_text: '',
          stay_date: '',
          room_number: '',
          contact_phone: '',
          contact_email: '',
          matched_lost_item_id: '',
          shipping: { tracking_number: '', shipped_at: '', shipping_note: '' },
          created_at: timestamp,
          updated_at: timestamp
        };
        contactCases.unshift(freshCase);
        currentCaseId = freshCase.id;
        renderContactList();
        renderContactDetail();
        showToast('å•ã„åˆã‚ã›ã‚±ãƒ¼ã‚¹ã‚’ä½œæˆã—ã¾ã—ãŸ');
      });
    }

    renderContactList();
    renderContactDetail();

    // Mobile screens mock
    const mobileScreen = document.getElementById('mobileScreen');
    const mobileNext = document.getElementById('mobileNext');
    let step = 0;
    const mobileViews = [
      renderMobileHome,
      renderMobileCategory,
      renderMobilePhoto,
      renderMobileDetail,
      renderMobileConfirm
    ];

    function renderMobileHome() {
      mobileNext.textContent = 'è½ã¨ã—ç‰©ã‚’ç™»éŒ²ã™ã‚‹';
      return `
        <div class="mobile-card">
          <div class="brand" style="gap:8px; justify-content:flex-start;">
            <div class="brand-mark" style="width:30px;height:30px;font-size:12px;">LC</div>
            <div>
              <div style="font-weight:800; color:var(--heading);">è½ã¨ã—ç‰©ç®¡ç†</div>
              <small style="color:var(--muted); font-weight:600;">ãƒãƒƒã‚¯ãƒ¤ãƒ¼ãƒ‰ç”¨ãƒ›ãƒ¼ãƒ </small>
            </div>
          </div>
          <div class="mobile-primary">è½ã¨ã—ç‰©ã‚’ç™»éŒ²ã™ã‚‹</div>
          <div class="mobile-outline">ç™»éŒ²ã—ãŸè½ã¨ã—ç‰©ã‚’ç¢ºèªã™ã‚‹</div>
          <div style="text-align:center; color:var(--muted); font-size:12px;">ä¿ç®¡ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèª</div>
        </div>
      `;
    }
    function renderMobileCategory() {
      mobileNext.textContent = 'æ¬¡ã¸';
      const categories = ['è²¡å¸ƒ','ã‚«ãƒãƒ³','ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³','å……é›»å™¨','éµ','è¡£é¡','ãƒ•ã‚¡ãƒƒã‚·ãƒ§ãƒ³å°ç‰©','ãƒ¡ã‚¬ãƒ','åŒ–ç²§å“','é´','å‚˜','ãã®ä»–'];
      return `
        <div class="mobile-card">
          <div style="font-weight:800; color:var(--heading);">ã©ã‚“ãªè½ã¨ã—ç‰©ã§ã™ã‹ï¼Ÿ</div>
          <div class="mobile-grid">
            ${categories.map((c,i)=>`<div class="mobile-option ${i===0?'active':''}">${c}</div>`).join('')}
          </div>
        </div>
      `;
    }
    function renderMobilePhoto() {
      mobileNext.textContent = 'å†™çœŸã‚’æ’®ã£ã¦æ¬¡ã¸';
      return `
        <div class="mobile-card" style="text-align:center;">
          <div style="font-weight:800; color:var(--heading);">å†™çœŸã‚’æ’®å½±ã—ã¦ãã ã•ã„</div>
          <div style="margin:10px auto; width:100%; aspect-ratio:1/1; border-radius:14px; border:1px dashed var(--border); display:grid; place-items:center; color:var(--muted); background:linear-gradient(135deg, rgba(37,99,235,0.06), rgba(14,165,233,0.06));">
            <div>ğŸ“· ã‚¿ãƒƒãƒ—ã—ã¦æ’®å½±</div>
          </div>
          <div style="color:var(--primary); font-weight:700; font-size:13px;">æ’®ã‚Šç›´ã™</div>
        </div>
      `;
    }
    function renderMobileDetail() {
      mobileNext.textContent = 'ä¿ç®¡å ´æ‰€ã¸';
      return `
        <div class="mobile-card" style="gap:8px;">
          <div style="font-weight:800; color:var(--heading);">ã©ã“ã§ã€ã„ã¤è¦‹ã¤ã‹ã‚Šã¾ã—ãŸã‹ï¼Ÿ</div>
          <div class="input" style="text-align:left;">
            <div class="label">ç™ºè¦‹æ—¥</div>
            <input type="text" value="ä»Šæ—¥" />
          </div>
          <div class="pills">
            <div class="pill active">ä»Šæ—¥</div>
            <div class="pill">æ˜¨æ—¥</div>
          </div>
          <div class="input" style="text-align:left;">
            <div class="label">æ‹¾å¾—å ´æ‰€</div>
            <input type="text" value="301å·å®¤" />
          </div>
          <div class="input" style="text-align:left;">
            <div class="label">ç‰¹å¾´ãƒ¡ãƒ¢</div>
            <textarea style="width:100%; min-height:72px; padding:10px; border:1px solid var(--border); border-radius:10px;">é»’ã„é•·è²¡å¸ƒ / é‡‘è‰²ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼</textarea>
          </div>
        </div>
      `;
    }
    function renderMobileConfirm() {
      mobileNext.textContent = 'ã“ã®å†…å®¹ã§ç™»éŒ²ã™ã‚‹';
      return `
        <div class="mobile-card" style="gap:10px;">
          <div style="font-weight:800; color:var(--heading);">ä¿ç®¡å ´æ‰€ã‚’æ•™ãˆã¦ãã ã•ã„</div>
          <div class="input" style="text-align:left;">
            <div class="label">ä¿ç®¡å ´æ‰€</div>
            <input type="text" value="å€‰åº«A-3" />
          </div>
          <div class="highlight" style="border-radius:12px;">ä¿ç®¡æœŸé™ï¼š2025/03/31ï¼ˆã‚ã¨45æ—¥ï¼‰</div>
          <div class="mobile-card" style="background:#F8FAFC; border-style:dashed;">
            <div class="label">ç™»éŒ²å†…å®¹ã®ç¢ºèª</div>
            <div style="font-weight:700; color:var(--heading);">A-023 / è²¡å¸ƒ</div>
            <div style="color:var(--muted); font-size:13px;">ç™ºè¦‹æ—¥ï¼š2025/03/15</div>
            <div style="color:var(--muted); font-size:13px;">æ‹¾å¾—å ´æ‰€ï¼š301å·å®¤</div>
            <div style="color:var(--muted); font-size:13px;">ç‰¹å¾´ï¼šé»’ã„é•·è²¡å¸ƒ / é‡‘è‰²ãƒ•ã‚¡ã‚¹ãƒŠãƒ¼</div>
            <div style="color:var(--muted); font-size:13px;">ä¿ç®¡å ´æ‰€ï¼šå€‰åº«A-3</div>
          </div>
          <div class="mobile-outline" style="border:1px solid var(--border); color:var(--muted-strong);">æˆ»ã‚‹</div>
        </div>
      `;
    }

    function renderMobile() {
      mobileScreen.innerHTML = mobileViews[step]();
    }

    function updateDots() {
      const dots = document.querySelectorAll('.dot');
      dots.forEach((d, i) => d.classList.toggle('active', i <= step));
    }

    mobileNext.addEventListener('click', () => {
      if (step < mobileViews.length - 1) {
        step += 1;
        renderMobile();
        updateDots();
      } else {
        showToast('ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸ');
      }
    });

    // Counters
    function updateCounters() {
      document.getElementById('todayCount').textContent = data.filter(d => d.date === '2025-03-16' || d.date === '2025-03-15').length + 'ä»¶';
      document.getElementById('stockCount').textContent = data.filter(d => d.status === 'ä¿ç®¡ä¸­').length + 'ä»¶';
      document.getElementById('warningCount').textContent = data.filter(d => d.status === 'æœŸé™é–“è¿‘').length + 'ä»¶';
      document.getElementById('expiredCount').textContent = data.filter(d => d.status === 'æœŸé™åˆ‡ã‚Œ').length + 'ä»¶';
    }

    renderTable();
    renderDeadline();
    renderMobile();
    updateDots();
    updateCounters();
    renderMatchGrid();
    renderRoomPills();
    switchMainTab('list');

    document.getElementById('addBtn').addEventListener('click', () => {
      showToast('ã€Œè½ã¨ã—ç‰©ã‚’ç™»éŒ²ã€ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãæƒ³å®š');
    });
  </script>
</body>
</html>
